<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>×—.×¡×‘×Ÿ ×—×•××¨×™ ×‘× ×™×™×Ÿ - ×¦'××˜ ××•× ×¤×©</title>
  <style>
    :root {
      --primary-color: #075e54;
      --secondary-color: #128c7e;
      --bg-color: #e5ddd5;
      --message-bg: #dcf8c6;
      --bot-message-bg: #ffffff;
      --error-color: #ff4d4d;
      --keyword-bg: linear-gradient(45deg, #25d366, #128c7e);
      --fallback-bg: url('https://via.placeholder.com/380x760?text=WhatsApp+Background');
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      background: linear-gradient(135deg, #f0f4f8, #d9e2ec);
      font-family: 'Rubik', sans-serif;
      overflow-x: hidden;
    }

    #phoneFrame {
      width: 380px;
      height: 760px;
      background: url('https://i.postimg.cc/t4Q91FDQ/Screenshot-20250427-160448-Whats-App-Business.jpg') no-repeat center/cover, var(--fallback-bg);
      border: 10px solid #000;
      border-radius: 40px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      position: relative;
      overflow: hidden;
      transition: all 0.3s ease;
    }

    #phoneFrame.fullscreen {
      width: 100vw;
      height: 100vh;
      border: none;
      border-radius: 0;
    }

    #chatContainer {
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      background: transparent;
    }

    #chatHeader {
      background: var(--primary-color);
      color: white;
      padding: 10px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    }

    #chatHeader img {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      margin-left: 10px;
    }

    #chatHeader h1 {
      font-size: 18px;
      flex-grow: 1;
    }

    #chatBody {
      flex-grow: 1;
      padding: 10px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 10px;
      background: transparent;
    }

    .message {
      max-width: 80%;
      padding: 10px;
      border-radius: 10px;
      position: relative;
      font-size: 16px;
      line-height: 1.4;
      word-wrap: break-word;
    }

    .user-message {
      background: var(--message-bg);
      align-self: flex-end;
      margin-left: 10px;
      border-bottom-right-radius: 2px;
    }

    .bot-message {
      background: var(--bot-message-bg);
      align-self: flex-start;
      margin-right: 10px;
      border-bottom-left-radius: 2px;
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
    }

    .welcome-message, .name-prompt {
      font-weight: bold;
      color: var(--primary-color);
    }

    .message-time {
      font-size: 12px;
      color: #888;
      position: absolute;
      bottom: -18px;
      left: 10px;
    }

    .typing {
      display: flex;
      gap: 5px;
      align-self: flex-start;
      padding: 10px;
    }

    .typing span {
      width: 8px;
      height: 8px;
      background: var(--primary-color);
      border-radius: 50%;
      animation: typing 1.2s infinite;
    }

    .typing span:nth-child(2) { animation-delay: 0.2s; }
    .typing span:nth-child(3) { animation-delay: 0.4s; }

    @keyframes typing {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }

    #keywordsContainer {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 300px;
      height: 300px;
      display: none;
    }

    #keywordsContainer.active {
      display: block;
    }

    .keyword-btn {
      position: absolute;
      padding: 10px 20px;
      background: var(--keyword-bg);
      color: white;
      border: none;
      border-radius: 20px;
      cursor: pointer;
      font-size: 14px;
      font-weight: bold;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
      transition: all 0.3s ease;
      animation: spin 10s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg) translateX(150px) rotate(0deg); }
      100% { transform: rotate(360deg) translateX(150px) rotate(-360deg); }
    }

    @keyframes throwEffect {
      0% { transform: translate(0, 0) scale(1); opacity: 1; }
      100% { transform: translate(100px, -100px) scale(0.5); opacity: 0; }
    }

    #chatFooter {
      display: flex;
      align-items: center;
      padding: 10px;
      background: var(--bg-color);
      border-top: 1px solid #ccc;
      position: relative;
    }

    #userInput {
      flex-grow: 1;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 20px;
      font-size: 16px;
      outline: none;
      transition: border-color 0.3s ease;
    }

    #userInput.guide {
      border-color: var(--secondary-color);
      box-shadow: 0 0 5px var(--secondary-color);
    }

    #sendBtn, #attachBtn, .fullscreen-btn {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      margin: 0 5px;
      color: var(--primary-color);
    }

    #attachMenu {
      display: none;
      position: absolute;
      bottom: 60px;
      left: 10px;
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
      padding: 10px;
      z-index: 10;
    }

    #attachMenu button {
      display: block;
      background: none;
      border: none;
      padding: 10px;
      font-size: 16px;
      color: var(--primary-color);
      cursor: pointer;
      width: 100%;
      text-align: right;
    }

    #stylus {
      position: absolute;
      bottom: 20px;
      left: 30px;
      width: 24px;
      height: 24px;
      background: url('https://i.postimg.cc/3J9Y4b0Z/blocks.jpg') no-repeat center/cover;
      transition: transform 0.2s ease;
      pointer-events: none;
    }

    #stylus.typing {
      transform: translateX(10px) rotate(10deg);
    }

    #virtualKeyboard {
      display: none;
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: #f0f0f0;
      padding: 10px;
      flex-wrap: wrap;
      gap: 5px;
      justify-content: center;
    }

    #virtualKeyboard button {
      padding: 10px;
      font-size: 18px;
      border: 1px solid #ccc;
      border-radius: 5px;
      background: white;
      cursor: pointer;
    }

    #orderPopup, #howToPopup {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      z-index: 100;
      max-width: 90%;
      max-height: 80vh;
      overflow-y: auto;
    }

    #overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 99;
    }

    #orderForm, #howToContent {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    #orderForm input, #orderForm select {
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 5px;
      font-size: 16px;
    }

    .item-row {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .item-name, .item-quantity, .item-price {
      flex: 1;
      padding: 5px;
    }

    .item-price {
      background: #f0f0f0;
    }

    .remove-item {
      background: var(--error-color);
      color: white;
      border: none;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      cursor: pointer;
    }

    #containerCost {
      display: none;
      color: var(--error-color);
      font-size: 14px;
    }

    .error-message {
      color: var(--error-color);
      text-align: center;
      font-weight: bold;
      margin: 20px;
    }

    @media (max-width: 400px) {
      #phoneFrame {
        width: 100%;
        height: 100vh;
        border: none;
        border-radius: 0;
      }
    }
  </style>
</head>
<body>
  <div id="phoneFrame">
    <div id="chatContainer">
      <div id="chatHeader">
        <img src="https://i.postimg.cc/3J9Y4b0Z/blocks.jpg" alt="×‘×œ×•×§×™×">
        <h1>×—.×¡×‘×Ÿ ×—×•××¨×™ ×‘× ×™×™×Ÿ</h1>
        <button class="fullscreen-btn" onclick="toggleFullscreen()">ğŸ”²</button>
      </div>
      <div id="chatBody"></div>
      <div id="keywordsContainer"></div>
      <div id="chatFooter">
        <button id="attachBtn" onclick="toggleAttachMenu()">ğŸ“</button>
        <div id="attachMenu">
          <button onclick="document.getElementById('fileInput').click()">ğŸ“„ ×”×¢×œ××ª ×§×•×‘×¥</button>
          <button onclick="shareLocation()">ğŸ“ ×©×™×ª×•×£ ××™×§×•×</button>
          <button onclick="addToCalendar()">ğŸ“… ×”×•×¡×£ ×œ×œ×•×— ×©× ×”</button>
          <button onclick="showKeyboard()">âŒ¨ï¸ ××§×œ×“×ª ×•×™×¨×˜×•××œ×™×ª</button>
        </div>
        <input type="file" id="fileInput" style="display: none;" onchange="uploadFile()">
        <div id="stylus"></div>
        <input type="text" id="userInput" placeholder="×”×§×œ×“ ×”×•×“×¢×”..." oninput="moveStylus()" onkeypress="if(event.key === 'Enter') sendMessage()">
        <button id="sendBtn" onclick="sendMessage()">â¤</button>
      </div>
    </div>
  </div>
  <div id="virtualKeyboard">
    <button onclick="typeKey('×')">×</button>
    <button onclick="typeKey('×‘')">×‘</button>
    <button onclick="typeKey('×’')">×’</button>
    <button onclick="typeKey('×“')">×“</button>
    <button onclick="typeKey('×”')">×”</button>
    <button onclick="typeKey('×•')">×•</button>
    <button onclick="typeKey('×–')">×–</button>
    <button onclick="typeKey('×—')">×—</button>
    <button onclick="typeKey('×˜')">×˜</button>
    <button onclick="typeKey('×™')">×™</button>
    <button onclick="typeKey('×›')">×›</button>
    <button onclick="typeKey('×œ')">×œ</button>
    <button onclick="typeKey('×')">×</button>
    <button onclick="typeKey('× ')">× </button>
    <button onclick="typeKey('×¡')">×¡</button>
    <button onclick="typeKey('×¢')">×¢</button>
    <button onclick="typeKey('×¤')">×¤</button>
    <button onclick="typeKey('×¦')">×¦</button>
    <button onclick="typeKey('×§')">×§</button>
    <button onclick="typeKey('×¨')">×¨</button>
    <button onclick="typeKey('×©')">×©</button>
    <button onclick="typeKey('×ª')">×ª</button>
    <button onclick="typeKey(' ')">×¨×•×•×—</button>
    <button onclick="sendMessage()">×©×œ×—</button>
    <button onclick="closeKeyboard()">×¡×’×•×¨</button>
  </div>
  <div id="orderPopup">
    <h2>×˜×•×¤×¡ ×”×–×× ×”</h2>
    <div id="orderForm">
      <input type="text" id="orderCustomer" placeholder="×©× ×”×œ×§×•×—">
      <input type="text" id="orderContact" placeholder="××™×© ×§×©×¨">
      <input type="tel" id="orderPhone" placeholder="××¡×¤×¨ ×˜×œ×¤×•×Ÿ">
      <select id="orderCrane">
        <option value="×œ×œ×">×œ×œ× ×× ×•×£</option>
        <option value="×× ×•×£">×¢× ×× ×•×£</option>
      </select>
      <input type="text" id="orderStreet" placeholder="×¨×—×•×‘">
      <input type="text" id="orderCity" placeholder="×¢×™×¨">
      <select id="orderContainer" onchange="showContainerCost()">
        <option value="×œ×œ×">×œ×œ× ××›×•×œ×”</option>
        <option value="6 ×§×•×‘">××›×•×œ×” 6 ×§×•×‘</option>
        <option value="12 ×§×•×‘">××›×•×œ×” 12 ×§×•×‘</option>
      </select>
      <p id="containerCost">×¢×œ×•×ª ××›×•×œ×”: 1500 ×©"×— (×œ× ×›×•×œ×œ ××¢"×)</p>
      <table>
        <thead>
          <tr>
            <th>×©× ×”××•×¦×¨</th>
            <th>×›××•×ª</th>
            <th>××—×™×¨</th>
            <th></th>
          </tr>
        </thead>
        <tbody id="itemsTableBody">
          <tr class="item-row">
            <td><select class="item-name" onchange="updateItemPrice(this)"></select></td>
            <td><input type="number" class="item-quantity" min="1" placeholder="×›××•×ª"></td>
            <td><input type="text" class="item-price" readonly></td>
            <td><button class="remove-item" onclick="removeItemRow(this)">Ã—</button></td>
          </tr>
        </tbody>
      </table>
      <button onclick="addItemRow()">+ ×”×•×¡×£ ×¤×¨×™×˜</button>
      <button onclick="submitOrder()">×©×œ×— ×”×–×× ×”</button>
      <button onclick="closeOrderPopup()">×‘×˜×œ</button>
    </div>
  </div>
  <div id="howToPopup">
    <h2>××™×š ×× ×™ ×¢×•×‘×“?</h2>
    <div id="howToContent">
      <p>×©×œ×•×! ×× ×™ ×¨×××™, ×”×‘×•×˜ ×©×œ ×—.×¡×‘×Ÿ ×—×•××¨×™ ×‘× ×™×™×Ÿ! ğŸ˜</p>
      <p>×× ×™ ×›××Ÿ ×›×“×™ ×œ×¢×–×•×¨ ×œ×š ×¢× ××™×“×¢ ×¢×œ ××•×¦×¨×™×, ×”×–×× ×•×ª, ××• ×¡×ª× ×œ×©×•×—×— ×¢×œ ×”××—×¡×Ÿ!</p>
      <p>××™×š ×œ×”×©×ª××© ×‘×™:</p>
      <ul>
        <li>×”×§×œ×“ ××ª ×©××š ×›×“×™ ×œ×”×ª×—×™×œ.</li>
        <li>×œ×—×¥ ×¢×œ ××™×œ×•×ª ××¤×ª×— ××¡×ª×•×‘×‘×•×ª ××• ×”×§×œ×“ ×©××œ×•×ª ×›××• "×‘×œ×•×§×™×" ××• "×¦×‘×¢×™×".</li>
        <li>×¤×ª×— ×˜×•×¤×¡ ×”×–×× ×” ×›×“×™ ×œ×©×œ×•×— ×”×–×× ×” ×™×©×™×¨×•×ª ×œ××—×¡×Ÿ.</li>
        <li>×©×œ×— ×§×‘×¦×™×, ×©×ª×£ ××™×§×•×, ××• ×”×•×¡×£ ××™×¨×•×¢×™× ×œ×œ×•×— ×”×©× ×”!</li>
      </ul>
      <button onclick="closeHowToPopup()">×¡×’×•×¨</button>
    </div>
  </div>
  <div id="overlay"></div>

  <script>
    let userName = '';
    let userPhone = '';
    let conversation = [];
    let responses = [];
    let products = [];
    let keywords = [];
    let namePrompted = false;

    const API_KEY = 'AIzaSyCNn7GZMsQPCdRSfgz_o08M1YV63CkA3Ow'; // ×”×—×œ×£ ×‘××¤×ª×— API ×©×œ Google Sheets
    const SCRIPT_URL = 'YOUR_NEW_SCRIPT_URL'; // ×”×—×œ×£ ×‘-URL ×©×œ ×”-Web App

    const fallbackKeywords = [
      { label: '×‘×œ×•×§×™×', question: '××™×“×¢ ×¢×œ ×‘×œ×•×§×™×' },
      { label: '×¦×‘×¢×™×', question: '××™×“×¢ ×¢×œ ×¦×‘×¢×™×' },
      { label: '×›×œ×™×', question: '××™×“×¢ ×¢×œ ×›×œ×™×' },
      { label: '×”×–×× ×”', question: '×¤×ª×— ×˜×•×¤×¡ ×”×–×× ×”' }
    ];

    const nameData = {
      '×•×¨×“': {
        traits: '×–×•×¨×—×ª ×›××• ×¤×¨×—, ××œ××ª ×—×™×™× ×•×× ×¨×’×™×”!',
        ramiThought: '×•×¨×“ ×”×™× ×›××• ×‘×œ×•×§ ××•×©×œ× â€“ ×™×¤×”, ×—×–×§×”, ×•×ª××™×“ ××•×¡×™×¤×” ×¦×‘×¢! ğŸŒ¹',
        quip: '×•×¨×“, ×¢× ×©× ×›×–×”, ××ª ×‘×˜×— ×©×•×‘×¨×ª ×œ×‘×‘×•×ª ×‘××—×¡×Ÿ! ğŸ˜œ'
      },
      '×ª××™×¨': {
        traits: '××¢×•×“×“, ×ª××™×“ ×¢× ×—×™×•×š, ××—×¡× ××™ ××¡×¤×¨ ××—×ª!',
        ramiThought: '×ª××™×¨ ×”×•× ×”×—×‘×¨ ×©×ª××™×“ ×©× ×›×©×”××©××¨×ª × ×”×™×™×ª ×§×©×”! ğŸ’ª',
        quip: '×ª××™×¨, ××ª×” ××¢×•×“×“ ××ª ×›×•×œ×, ××‘×œ ××™ ××¢×•×“×“ ××•×ª×š ×›×©××©×¨ ×©×•×‘ ××“×¤×™×¡ ××ª ×”×©×‘×•×¢? ğŸ˜…'
      },
      '××•×¨×Ÿ': {
        traits: '×—×‘×™×‘, ×ª×•×ª×— ×¢×œ ×”××œ×’×–×”, ×§×¦×ª ×’××“ ××‘×œ ×¢× ×§ ×‘×œ×‘!',
        ramiThought: '××•×¨×Ÿ ×“×•×¤×§ ×¢×‘×•×“×” ×›×©×¦×¨×™×š, ××‘×œ ×œ×¤×¢××™× ×¦×¨×™×š ×œ×“×—×•×£ ××•×ª×• ×§×¦×ª! ğŸšœ',
        quip: '××•×¨×Ÿ, ×’××“×’××“, ××‘×œ ×›×©××ª×” ×¢×œ ×”××œ×’×–×”, ××ª×” ××œ×š ×”××—×¡×Ÿ! ğŸ˜'
      },
      '×¢×œ×': {
        traits: '×—×‘×¨×•×ª×™, ×ª××™×“ ×¢× ×¡×™×¤×•×¨ ×˜×•×‘, ××¨×™× ××ª ×”××•×¨×œ!',
        ramiThought: '×¢×œ× ××‘×™× ××ª ×”×× ×¨×’×™×”, ×›××• ××©××™×ª ××œ××” ×‘×œ×•×§×™×! ğŸšš',
        quip: '×¢×œ×, ×¢× ×”×¡×™×¤×•×¨×™× ×©×œ×š, ××ª×” ×¦×¨×™×š ×¤×•×“×§××¡×˜ ×‘××—×¡×Ÿ! ğŸ™ï¸'
      },
      '×¢×œ×™': {
        traits: '× ×××Ÿ, ×¢×•×‘×“ ×§×©×”, ×ª××™×“ × ×•×ª×Ÿ 100%!',
        ramiThought: '×¢×œ×™ ×”×•× ×›××• ××œ×˜ â€“ ××—×–×™×§ ×”×›×œ ×‘×™×—×“! ğŸ§±',
        quip: '×¢×œ×™, ××ª×” ×¢×•×‘×“ ×›×œ ×›×š ×§×©×”, ××¤×™×œ×• ×”××œ×’×–×” ××‘×§×©×ª ×”×¤×¡×§×”! ğŸ˜œ'
      },
      '×™×•××‘': {
        traits: '×—×›×, ×™×¦×™×¨×ª×™, ×ª××™×“ ×¢× ×¤×ª×¨×•×Ÿ ×œ×›×œ ×‘×¢×™×”!',
        ramiThought: '×™×•××‘ ×”×•× ×”×¨××© ×”×—×•×©×‘ ×©×œ ×”××—×¡×Ÿ, ×›××• ××”× ×“×¡ ×‘×œ×•×§×™×! ğŸ§ ',
        quip: '×™×•××‘, ×¢× ×”×¨××© ×©×œ×š, ××ª×” ×ª××¦×™× ×‘×œ×•×§ ×©××¨×›×™×‘ ××ª ×¢×¦××•! ğŸ˜…'
      },
      '× ×ª× ××œ': {
        traits: '×¨×’×•×¢, ×××™×Ÿ, ×ª××™×“ ×©×•××¨ ×¢×œ ×§×•×¨ ×¨×•×—!',
        ramiThought: '× ×ª× ××œ ×”×•× ×›××• ××™× ×‘×™×•× ×—× â€“ ××¨×’×™×¢ ××ª ×›×•×œ×! ğŸ’§',
        quip: '× ×ª× ××œ, ××ª×” ×›×œ ×›×š ×¨×’×•×¢, ××¤×™×œ×• ××©×¨ ×œ× ××¦×œ×™×— ×œ×”×•×¦×™× ××•×ª×š ××”×§×¦×‘! ğŸ˜'
      },
      '×“×•×¨×•×Ÿ': {
        traits: '× ×“×™×‘, ×ª××™×“ ×¢×•×–×¨, ×œ×‘ ×–×”×‘!',
        ramiThought: '×“×•×¨×•×Ÿ ×”×•× ×›××• ××©××™×ª ×©××‘×™××” ××ª ×›×œ ×”×˜×•×‘ ×œ××—×¡×Ÿ! ğŸš›',
        quip: '×“×•×¨×•×Ÿ, ×¢× ×”×œ×‘ ×©×œ×š, ××ª×” ×™×›×•×œ ×œ××›×•×¨ ×‘×œ×•×§×™× ×‘×—×™× × ×•×¢×“×™×™×Ÿ ×œ×”×¨×•×•×™×—! ğŸ˜œ'
      },
      '×œ×™× ×”': {
        traits: '××”×•×‘×ª ×œ×‘×• ×©×œ ×¨×××™, ××§×¡×™××” ×•××œ××ª ×§×¡×!',
        ramiThought: '×œ×™× ×” ×”×™× ×”×œ×‘ ×©×œ ×”××—×¡×Ÿ, ×›×œ ×™×•× ××™×ª×” ×”×•× ×›××• ×—×’! ğŸ’–',
        quip: '×œ×™× ×”, ×¨×××™ ××•××¨ ×©××ª ×”×‘×œ×•×§ ×”×›×™ ×™×¤×” ×‘××—×¡×Ÿ! ğŸ˜'
      },
      '×©×¨×•×Ÿ': {
        traits: '×¦×¨×¤×ª×™×” ××¨×¢× × ×”, ×ª××™×“ ×¢× ×¡×˜×™×™×œ ×•×—×™×•×š!',
        ramiThought: '×©×¨×•×Ÿ ××‘×™××” ×§×œ××¡×” ×œ××—×¡×Ÿ, ×›××• ×¦×‘×¢ ×¤×¨×™××™×•×! ğŸ¨',
        quip: '×©×¨×•×Ÿ, ×¢× ×”×¡×˜×™×™×œ ×©×œ×š, ××ª ×™×›×•×œ×” ×œ××›×•×¨ ×‘×œ×•×§×™× ×‘×ª×¦×•×’×ª ××•×¤× ×”! ğŸ˜…'
      },
      '××©×¨': {
        traits: '××©×’×¢ ××ª ×›×•×œ× ×¢× ×”×“×¤×¡×•×ª ×”×©×‘×•×¢, ××‘×œ ×ª××™×“ ××¦×—×™×§!',
        ramiThought: '××©×¨ ×”×•× ×›××• ××©××™×ª ×©×œ× ×§×•×¨××ª ××ª ×”××¡×œ×•×œ, ××‘×œ ×‘×¡×•×£ ××’×™×¢! ğŸ“„',
        quip: '××©×¨, ×ª×¤×¡×™×§ ×œ×”×“×¤×™×¡ ××ª ×”×©×‘×•×¢, ×¨×××™ ×›×‘×¨ ×œ× ×™×›×•×œ ×œ×¨××•×ª × ×™×™×¨! ğŸ˜œ'
      }
    };

    function preloadImages() {
      const images = [
        { src: 'https://i.postimg.cc/t4Q91FDQ/Screenshot-20250427-160448-Whats-App-Business.jpg', fallback: 'https://via.placeholder.com/380x760?text=WhatsApp+Background' },
        { src: 'https://i.postimg.cc/3J9Y4b0Z/blocks.jpg', fallback: 'https://via.placeholder.com/24?text=Stylus' },
        { src: 'https://i.postimg.cc/5y3t8QzT/paint.jpg', fallback: 'https://via.placeholder.com/220?text=Paint' },
        { src: 'https://i.postimg.cc/4yqP2R9Z/tools.jpg', fallback: 'https://via.placeholder.com/220?text=Tools' }
      ];
      images.forEach(image => {
        const img = new Image();
        img.src = image.src;
        img.onerror = () => { img.src = image.fallback; };
      });
    }

    async function fetchResponses() {
      try {
        const sheetId = '13fP3cH_npVSYz-cHZWL27-cGwHldBP3VdnBdFZq4wN0';
        const response = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/Sheet1!A1:D1000?key=${API_KEY}`);
        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
        const data = await response.json();
        if (!data.values || data.values.length < 2) throw new Error('No responses found');
        responses = data.values.slice(1).map(row => ({
          question: row[0] || '',
          answer: row[1] || '',
          keywords: row[2] ? row[2].split(',').map(k => k.trim()) : [],
          synonyms: row[3] ? row[3].split(',').map(s => s.trim()) : []
        }));
        keywords = responses.map(r => ({ label: r.question, question: r.question }));
        updateKeywords();
      } catch (err) {
        console.error('Error fetching responses:', err);
        responses = [];
        keywords = fallbackKeywords;
        updateKeywords();
        displayBotMessage('××•×¤×¡, ×œ× ×”×¦×œ×—×ª×™ ×œ×˜×¢×•×Ÿ ××ª ×”×ª×©×•×‘×•×ª... ğŸ˜… ××‘×œ ××œ ×“××’×”, ×× ×™ ×¢×“×™×™×Ÿ ×›××Ÿ! × ×¡×” ×œ×©××•×œ ×¢×œ "×‘×œ×•×§×™×" ××• "×¦×‘×¢×™×".');
      }
    }

    async function fetchProducts() {
      try {
        const sheetId = '1T14O3eVJzJqBXe6pr5flLckvpM4TGRycTYp5Elq2KSY';
        const response = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/Sheet1!A1:E1000?key=${API_KEY}`);
        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
        const data = await response.json();
        if (!data.values || data.values.length < 2) throw new Error('No products found');
        products = data.values.slice(1).map(row => ({
          name: row[0] || '',
          category: row[1] || '',
          price: parseFloat(row[2]) || 0,
          stock: parseInt(row[3]) || 0,
          description: row[4] || ''
        }));
        updateProductSelects();
      } catch (err) {
        console.error('Error fetching products:', err);
        products = [];
        displayBotMessage('××•×¤×¡, ×œ× ×”×¦×œ×—×ª×™ ×œ×˜×¢×•×Ÿ ××ª ×”××•×¦×¨×™×... ğŸ˜… ××‘×œ ×ª×•×›×œ ×œ×”×–××™×Ÿ ×“×¨×š ×”×˜×•×¤×¡!');
      }
    }

    function updateProductSelects() {
      const selects = document.querySelectorAll('.item-name');
      if (!selects.length) return;
      selects.forEach(select => {
        select.innerHTML = '<option value="">×‘×—×¨ ××•×¦×¨</option>' + products.map(product => 
          `<option value="${product.name}" data-price="${product.price}" data-stock="${product.stock}">${product.name} (${product.stock} ×‘××œ××™)</option>`
        ).join('');
      });
    }

    function updateItemPrice(select) {
      const row = select.closest('.item-row');
      if (!row) return;
      const priceInput = row.querySelector('.item-price');
      const selectedOption = select.options[select.selectedIndex];
      const price = selectedOption ? selectedOption.getAttribute('data-price') : '';
      priceInput.value = price ? `${price} ×©"×—` : '';
    }

    async function saveUser(name, phone) {
      try {
        const response = await fetch(SCRIPT_URL, {
          method: 'POST',
          body: JSON.stringify({ action: 'saveUser', data: { name, phone } })
        });
        const result = await response.json();
        if (result.status !== '×”×¦×œ×—×”') throw new Error(result.message);
      } catch (err) {
        console.error('Error saving user:', err);
        displayBotMessage('×œ× ×”×¦×œ×—×ª×™ ×œ×©××•×¨ ××ª ×”××©×ª××©, ××‘×œ × ××©×™×š ×”×œ××”! ğŸ˜');
      }
    }

    async function saveChat(userName, question, answer) {
      try {
        const response = await fetch(SCRIPT_URL, {
          method: 'POST',
          body: JSON.stringify({ action: 'saveChat', data: { userName, question, answer } })
        });
        const result = await response.json();
        if (result.status !== '×”×¦×œ×—×”') throw new Error(result.message);
      } catch (err) {
        console.error('Error saving chat:', err);
      }
    }

    async function updateStats(messageCount, orderCount) {
      try {
        const response = await fetch(SCRIPT_URL, {
          method: 'POST',
          body: JSON.stringify({ action: 'updateStats', data: { messageCount, orderCount } })
        });
        const result = await response.json();
        if (result.status !== '×”×¦×œ×—×”') throw new Error(result.message);
      } catch (err) {
        console.error('Error updating stats:', err);
      }
    }

    async function addToResponses(question, answer, keywords = [], synonyms = []) {
      try {
        const response = await fetch(SCRIPT_URL, {
          method: 'POST',
          body: JSON.stringify({
            action: 'addResponse',
            data: { question, answer, keywords: keywords.join(','), synonyms: synonyms.join(',') }
          })
        });
        const result = await response.json();
        if (result.status !== '×”×¦×œ×—×”') throw new Error(result.message);
        responses.push({ question, answer, keywords, synonyms });
        keywords.push({ label: question, question });
        updateKeywords();
      } catch (err) {
        console.error('Error adding to responses:', err);
      }
    }

    async function sendMessage(inputText = null) {
      const chatBody = document.getElementById('chatBody');
      if (!chatBody) {
        console.error('chatBody not found');
        return;
      }

      const userInput = document.getElementById('userInput');
      if (!userInput) {
        console.error('userInput not found');
        return;
      }

      const message = inputText || userInput.value.trim();
      if (!message) return;

      displayUserMessage(message);
      userInput.value = '';
      moveStylus();

      if (!userName) {
        userName = message;
        await saveUser(userName, userPhone);
        displayBotMessage(`× ×¢×™× ×œ×”×›×™×¨, ${userName}! ğŸ˜ ×× ×™ ×¨×××™, ×”×‘×•×˜ ×©×œ ×—.×¡×‘×Ÿ ×—×•××¨×™ ×‘× ×™×™×Ÿ!`);
        if (nameData[userName]) {
          const nameInfo = nameData[userName];
          displayBotMessage(`<span class="name-prompt">×ª×¨×¦×” ×©××’×œ×” ×œ×š ××” ××•××¨ ×”×©× ×©×œ×š ×¢×“ ×©×¨×××™ ×™×¢× ×”? ğŸ˜</span>`);
          namePrompted = true;
        } else {
          displayBotMessage('××™×š ××¤×©×¨ ×œ×¢×–×•×¨ ×œ×š ×”×™×•×? ğŸ—ï¸');
          updateKeywords();
        }
        return;
      }

      if (namePrompted && (message.toLowerCase().includes('×›×Ÿ') || message.toLowerCase().includes('×‘×˜×—'))) {
        namePrompted = false;
        await handleNamePrediction(userName);
        return;
      }

      showTypingIndicator();
      const response = findResponse(message);
      setTimeout(async () => {
        hideTypingIndicator();
        displayBotMessage(response);
        await saveChat(userName, message, response);
        await updateStats(conversation.length, document.querySelectorAll('.item-row').length);
        if (nameData[userName] && Math.random() < 0.3) {
          displayBotMessage(nameData[userName].quip);
        }
      }, 1000);
    }

    async function handleNamePrediction(name) {
      if (name === '×•×¨×“') {
        const motivation = [
          '×•×¨×“, ××ª ×›××• ×¤×¨×— ×©×¤×•×¨×— ×‘×›×œ ××¦×‘! ğŸŒ¹',
          '×”×©× ×©×œ×š ××‘×™× ××•×¨ ×œ×›×œ ××—×¡×Ÿ, ×ª××©×™×›×™ ×œ×–×¨×•×—!',
          '×•×¨×“, ×”×›×•×— ×©×œ×š ×”×•× ×›××• ×‘×œ×•×§ â€“ ××™ ××¤×©×¨ ×œ×©×‘×•×¨ ××•×ª×•!'
        ];
        const encouragement = [
          '×•×¨×“, ×‘×¢×‘×•×“×” ××ª ×ª××™×“ ×ª×–×¨×—×™ ×›××• ×›×•×›×‘! ğŸŒŸ',
          '×”×™×œ×“×™× ×©×œ×š ×‘×˜×— ×’××™× ×‘×š, ×•×¨×“, ××ª ××× ××“×”×™××”!',
          '×•×¨×“, ×ª××©×™×›×™ ×œ× ×”×œ ××ª ×”×›×œ ×›××• ×‘×•×¡×™×ª ×‘××—×¡×Ÿ!'
        ];
        const prediction = `×•×¨×“, ×”×©× ×©×œ×š ×–×•×¨×— ×›××• ×¤×¨×—! ğŸŒ¹ ×ª×¨×¦×™ ×œ×“×¢×ª ××” ×¦×¤×•×™ ×œ×š? ×•×•××•, ×™×© ×›×œ ×›×š ×”×¨×‘×” ×œ×”×¨×—×™×‘! ×× ×™ ×—×•×–×” ×©×ª××©×™×›×™ ×œ×”×¤×™×¥ ××•×¨ ×‘×›×œ ××§×•×, ×•×¨×××™ ×‘×˜×•×— ×™×¡×›×™×! ğŸ˜`;
        displayBotMessage(prediction);
        for (const msg of [...motivation, ...encouragement]) {
          await addToResponses(`××•×˜×™×‘×¦×™×” ×œ×•×¨×“`, msg, ['×•×¨×“', '××•×˜×™×‘×¦×™×”'], ['×—×™×–×•×™', '×¢×™×“×•×“']);
        }
      } else if (nameData[name]) {
        const { traits, ramiThought, quip } = nameData[name];
        displayBotMessage(`×•×•××•, ${name}! ×”×©× ×©×œ×š ××•××¨: ${traits} ğŸ˜ ×¨×××™ ×—×•×©×‘: "${ramiThought}"`);
        displayBotMessage(quip);
        await addToResponses(`×—×™×–×•×™ ×œ-${name}`, `${traits} | ${ramiThought} | ${quip}`, [name, '×—×™×–×•×™'], ['×©×', '×¨×××™']);
      } else {
        displayBotMessage(`×”×©× ${name} ×××© ××’× ×™×‘! ğŸ˜ ×× ×™ ×—×•×–×” ×©×ª×”×™×” ×›×•×›×‘ ×‘××—×¡×Ÿ, ×•×¨×××™ ×‘×˜×— ××¡×›×™×!`);
        await addToResponses(`×—×™×–×•×™ ×œ-${name}`, `×›×•×›×‘ ×‘××—×¡×Ÿ!`, [name, '×—×™×–×•×™'], ['×©×', '×¨×××™']);
      }
    }

    function findResponse(message) {
      const messageLower = message.toLowerCase();
      for (const response of responses) {
        const keywords = response.keywords.map(k => k.toLowerCase());
        const synonyms = response.synonyms.map(s => s.toLowerCase());
        if (keywords.some(k => messageLower.includes(k)) || 
            synonyms.some(s => messageLower.includes(s)) ||
            messageLower.includes(response.question.toLowerCase())) {
          return response.answer;
        }
      }
      return '×œ× ×”×‘× ×ª×™ ××ª ×”×©××œ×”... ğŸ¤” × ×¡×” ××™×œ×•×ª ××¤×ª×— ×›××• "×‘×œ×•×§×™×", "×¦×‘×¢×™×", ××• "×”×–×× ×”"!';
    }

    function displayUserMessage(message) {
      const chatBody = document.getElementById('chatBody');
      if (!chatBody) {
        console.error('chatBody not found');
        return;
      }
      const messageDiv = document.createElement('div');
      messageDiv.className = 'message user-message';
      messageDiv.innerHTML = `${message}<span class="message-time">${getCurrentTime()}</span>`;
      chatBody.appendChild(messageDiv);
      chatBody.scrollTop = chatBody.scrollHeight;
      conversation.push({ type: 'user', text: message });
    }

    function displayBotMessage(message) {
      const chatBody = document.getElementById('chatBody');
      if (!chatBody) {
        console.error('chatBody not found');
        return;
      }
      const messageDiv = document.createElement('div');
      messageDiv.className = `message bot-message ${message.includes('×ª×¨×¦×” ×©××’×œ×”') ? 'name-prompt' : ''}`;
      messageDiv.innerHTML = `${message}<span class="message-time">${getCurrentTime()}</span>`;
      chatBody.appendChild(messageDiv);
      chatBody.scrollTop = chatBody.scrollHeight;
      conversation.push({ type: 'bot', text: message });
    }

    function showTypingIndicator() {
      const chatBody = document.getElementById('chatBody');
      if (!chatBody) return;
      const typingDiv = document.createElement('div');
      typingDiv.className = 'typing';
      typingDiv.innerHTML = '<span></span><span></span><span></span>';
      chatBody.appendChild(typingDiv);
      chatBody.scrollTop = chatBody.scrollHeight;
    }

    function hideTypingIndicator() {
      const typingDiv = document.querySelector('.typing');
      if (typingDiv) typingDiv.remove();
    }

    function getCurrentTime() {
      return new Date().toLocaleTimeString('he-IL', { hour: '2-digit', minute: '2-digit' });
    }

    function updateKeywords() {
      const keywordsContainer = document.getElementById('keywordsContainer');
      if (!keywordsContainer) {
        console.error('keywordsContainer not found');
        return;
      }
      keywordsContainer.innerHTML = '';
      const currentKeywords = userName ? keywords : [{ label: '×”×ª×—×œ ×©×™×—×”', question: '×”×™×™' }];
      if (!currentKeywords.length) {
        currentKeywords.push(...fallbackKeywords);
      }
      currentKeywords.forEach((keyword, index) => {
        const btn = document.createElement('button');
        btn.className = 'keyword-btn';
        btn.style.transform = `rotate(${index * (360 / currentKeywords.length)}deg) translateX(150px) rotate(-${index * (360 / currentKeywords.length)}deg)`;
        btn.style.animationDelay = `${index * 0.2}s`;
        btn.textContent = keyword.label;
        btn.onclick = () => {
          sendMessage(keyword.question);
          btn.style.animation = 'throwEffect 0.5s ease forwards';
          setTimeout(() => updateKeywords(), 500);
          displayBotMessage('×•×•××•, ×”×›×¤×ª×•×¨ ×–×¨×— ×›××• ×”×‘×œ×•×§×™× ×©×œ ×¨×××™! âœ¨');
        };
        keywordsContainer.appendChild(btn);
      });
    }

    function toggleFullscreen() {
      const phoneFrame = document.getElementById('phoneFrame');
      if (!phoneFrame) return;
      phoneFrame.classList.toggle('fullscreen');
      const btn = document.querySelector('.fullscreen-btn');
      if (btn) btn.textContent = phoneFrame.classList.contains('fullscreen') ? 'ğŸ”³' : 'ğŸ”²';
    }

    function toggleAttachMenu() {
      const menu = document.getElementById('attachMenu');
      if (!menu) return;
      menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
    }

    function showKeyboard() {
      const keyboard = document.getElementById('virtualKeyboard');
      if (!keyboard) return;
      keyboard.style.display = 'flex';
    }

    function closeKeyboard() {
      const keyboard = document.getElementById('virtualKeyboard');
      if (!keyboard) return;
      keyboard.style.display = 'none';
    }

    function typeKey(char) {
      const userInput = document.getElementById('userInput');
      if (!userInput) return;
      userInput.value += char;
      moveStylus();
    }

    function moveStylus() {
      const stylus = document.getElementById('stylus');
      const userInput = document.getElementById('userInput');
      if (!stylus || !userInput) return;
      if (userInput.value.trim()) {
        stylus.classList.add('typing');
      } else {
        stylus.classList.remove('typing');
      }
    }

    function uploadFile() {
      const fileInput = document.getElementById('fileInput');
      if (!fileInput || !fileInput.files[0]) return;
      const file = fileInput.files[0];
      const reader = new FileReader();
      reader.onload = () => {
        displayBotMessage(`×§×•×‘×¥ "${file.name}" × ×©×œ×—! ğŸ“„`);
      };
      reader.readAsDataURL(file);
    }

    function shareLocation() {
      if (!navigator.geolocation) {
        displayBotMessage('×©×™×ª×•×£ ××™×§×•× ×œ× × ×ª××š ×‘×“×¤×“×¤×Ÿ ×–×”... ğŸ˜”');
        return;
      }
      navigator.geolocation.getCurrentPosition(
        position => {
          const { latitude, longitude } = position.coords;
          displayBotMessage(`××™×§×•× ××©×•×ª×£: ${latitude}, ${longitude} ğŸ“`);
        },
        () => {
          displayBotMessage('×œ× ×”×¦×œ×—×ª×™ ×œ×§×‘×œ ××ª ×”××™×§×•×... ğŸ˜” ×•×“× ×©×”×¨×©××•×ª ×”××™×§×•× ××•×¤×¢×œ×•×ª.');
        }
      );
    }

    function addToCalendar() {
      displayBotMessage('××™×¨×•×¢ × ×•×¡×£ ×œ×œ×•×— ×”×©× ×” ×©×œ×š! ğŸ“…');
    }

    function openOrderPopup() {
      const popup = document.getElementById('orderPopup');
      const overlay = document.getElementById('overlay');
      if (popup && overlay) {
        popup.style.display = 'block';
        overlay.style.display = 'block';
      }
    }

    function closeOrderPopup() {
      const popup = document.getElementById('orderPopup');
      const overlay = document.getElementById('overlay');
      if (popup && overlay) {
        popup.style.display = 'none';
        overlay.style.display = 'none';
      }
    }

    function addItemRow() {
      const tableBody = document.getElementById('itemsTableBody');
      if (!tableBody) return;
      const row = document.createElement('tr');
      row.className = 'item-row';
      row.innerHTML = `
        <td><select class="item-name" onchange="updateItemPrice(this)"></select></td>
        <td><input type="number" class="item-quantity" min="1" placeholder="×›××•×ª"></td>
        <td><input type="text" class="item-price" readonly></td>
        <td><button class="remove-item" onclick="removeItemRow(this)">Ã—</button></td>
      `;
      tableBody.appendChild(row);
      updateProductSelects();
    }

    function removeItemRow(button) {
      const row = button.closest('.item-row');
      if (row) row.remove();
    }

    async function submitOrder() {
      const customer = document.getElementById('orderCustomer')?.value;
      const contact = document.getElementById('orderContact')?.value;
      const phone = document.getElementById('orderPhone')?.value;
      const crane = document.getElementById('orderCrane')?.value;
      const street = document.getElementById('orderStreet')?.value;
      const city = document.getElementById('orderCity')?.value;
      const container = document.getElementById('orderContainer')?.value;

      const items = Array.from(document.querySelectorAll('.item-row')).map(row => ({
        name: row.querySelector('.item-name').value,
        quantity: parseInt(row.querySelector('.item-quantity').value) || 1
      }));

      if (!customer || !contact || !phone || !items.every(item => item.name && item.quantity)) {
        displayBotMessage('×× × ××œ× ××ª ×›×œ ×”×©×“×•×ª ×‘×˜×•×¤×¡ ×”×”×–×× ×”! ğŸ“‹');
        return;
      }

      try {
        const response = await fetch(SCRIPT_URL, {
          method: 'POST',
          body: JSON.stringify({ action: 'saveOrder', data: { customer, contact, phone, crane, street, city, container, items } })
        });
        const result = await response.json();
        if (result.status !== '×”×¦×œ×—×”') throw new Error(result.message);
        displayBotMessage(`×”×”×–×× ×” × ×©×œ×—×” ×‘×”×¦×œ×—×”, ${customer}! ğŸš› ×ª×•×“×” ×©×§× ×™×ª ××¦×œ ×¨×××™!`);
        closeOrderPopup();
        await updateStats(conversation.length, document.querySelectorAll('.item-row').length);
      } catch (err) {
        console.error('Error submitting order:', err);
        displayBotMessage('××•×¤×¡, ×œ× ×”×¦×œ×—×ª×™ ×œ×©×œ×•×— ××ª ×”×”×–×× ×”... ğŸ˜… ×•×“× ×©×—×™×‘×•×¨ ×”××™× ×˜×¨× ×˜ ×ª×§×™×Ÿ.');
      }
    }

    function showContainerCost() {
      const container = document.getElementById('orderContainer');
      const costNote = document.getElementById('containerCost');
      if (container && costNote) {
        costNote.style.display = container.value !== '×œ×œ×' ? 'block' : 'none';
      }
    }

    function openHowToPopup() {
      const popup = document.getElementById('howToPopup');
      const overlay = document.getElementById('overlay');
      if (popup && overlay) {
        popup.style.display = 'block';
        overlay.style.display = 'block';
      }
    }

    function closeHowToPopup() {
      const popup = document.getElementById('howToPopup');
      const overlay = document.getElementById('overlay');
      if (popup && overlay) {
        popup.style.display = 'none';
        overlay.style.display = 'none';
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      try {
        const chatBody = document.getElementById('chatBody');
        const keywordsContainer = document.getElementById('keywordsContainer');
        const userInput = document.getElementById('userInput');
        if (!chatBody || !keywordsContainer || !userInput) {
          console.error('Essential elements missing:', { chatBody, keywordsContainer, userInput });
          document.body.innerHTML = '<h1 style="color: red; text-align: center;">×©×’×™××”: ×¨×›×™×‘×™ ×××©×§ ×—×¡×¨×™×. ×•×“× ×©×”-HTML ×ª×§×™×Ÿ.</h1>';
          return;
        }

        preloadImages();
        fetchResponses();
        fetchProducts();
        keywords = fallbackKeywords;
        updateKeywords();
        displayBotMessage('<span class="welcome-message">×‘×¨×•×š ×”×‘× ×œ×—.×¡×‘×Ÿ ×—×•××¨×™ ×‘× ×™×™×Ÿ, ×”×ª×œ××™×“ 6, ×”×•×“ ×”×©×¨×•×Ÿ! ğŸ—ï¸ ××™×š ×§×•×¨××™× ×œ×š? ğŸ˜</span>');
        setTimeout(() => {
          userInput.classList.add('guide');
          setTimeout(() => userInput.classList.remove('guide'), 6000);
        }, 2000);
      } catch (err) {
        console.error('Error on load:', err);
        displayBotMessage('××•×¤×¡, ××©×”×• ×”×©×ª×‘×© ×‘×˜×¢×™× ×ª ×”×“×£... ğŸ˜… ×•×“× ×©×—×™×‘×•×¨ ×”××™× ×˜×¨× ×˜ ×ª×§×™×Ÿ.');
      }
    });
  </script>
</body>
</html>
