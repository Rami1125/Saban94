<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×˜×•×¤×¡ ×”×–×× ×” ×—×“×©×” - ××©×•×“×¨×’</title>
    <!-- Tailwind CSS CDN for basic styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for Inter font and general layout */
        body {
            font-family: 'Inter', sans-serif;<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×˜×•×¤×¡ ×”×–×× ×” ×—×“×©×” - ××©×•×“×¨×’</title>
    <!-- Tailwind CSS CDN for basic styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for Inter font and general layout */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8; /* Very light blue-gray background */
            display: flex;
            justify-content: center;
            align-items: flex-start; /* Align to top for better content flow */
            min-height: 100vh; /* Full viewport height */
            padding: 2rem; /* Padding around the content */
            direction: rtl; /* Ensure RTL for the entire body */
        }
        .container {
            background-color: #ffffff; /* White background for the form container */
            padding: 3rem; /* Increased padding */
            border-radius: 1.5rem; /* More rounded corners */
            box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.15), 0 8px 16px -5px rgba(0, 0, 0, 0.08); /* More pronounced shadow */
            max-width: 1200px; /* Increased max width for larger page */
            width: 100%;
            text-align: right; /* Align text to the right for RTL */
            border: 1px solid #e2e8f0; /* Light border for the container */
        }
        h1, h2 {
            color: #1a202c; /* Darker gray for headings */
            margin-bottom: 1.5rem;
            text-align: center; /* Center headings */
            font-weight: 700; /* Bolder headings */
        }
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600; /* Bolder labels */
            color: #2d3748; /* Medium dark gray for labels */
        }
        input[type="text"], input[type="number"], input[type="email"], input[type="tel"], input[type="date"], input[type="time"], select, textarea {
            width: 100%;
            padding: 0.85rem; /* Slightly more padding */
            margin-bottom: 1rem;
            border: 1px solid #cbd5e0; /* Slightly darker light gray border */
            border-radius: 0.75rem; /* More rounded corners for inputs */
            font-size: 1rem;
            color: #4a5568; /* Darker gray for input text */
            background-color: #f7fafc; /* Slightly off-white background */
            transition: border-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        input[type="text"]:focus, input[type="number"]:focus, input[type="email"]:focus, input[type="tel"]:focus, input[type="date"]:focus, input[type="time"]:focus, select:focus, textarea:focus {
            border-color: #4c51bf; /* Deeper indigo border on focus */
            box-shadow: 0 0 0 4px rgba(76, 81, 191, 0.25); /* More prominent focus ring */
            outline: none;
        }

        /* Smart Button Styling with Shine Effect */
        .smart-button {
            position: relative;
            overflow: hidden;
            background-color: #4c51bf; /* Deeper indigo button */
            color: white;
            padding: 0.9rem 2rem; /* Larger padding */
            border-radius: 0.75rem; /* More rounded corners */
            font-weight: 600;
            transition: background-color 0.3s ease-in-out, box-shadow 0.3s ease-in-out, transform 0.1s ease-out, opacity 0.3s ease-in-out; /* Added opacity for disabled state */
            cursor: pointer;
            border: none;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); /* Default shadow */
        }
        .smart-button:hover {
            background-color: #3b429e; /* Even darker indigo on hover */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.15), 0 4px 6px -2px rgba(0, 0, 0, 0.08); /* Larger shadow on hover */
            transform: translateY(-2px); /* Slight lift effect */
        }
        .smart-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -75%; /* Start off-screen to the left */
            width: 50%; /* Width of the shine */
            height: 100%;
            background: linear-gradient(to right, rgba(255,255,255,0) 0%, rgba(255,255,255,.3) 100%); /* White to transparent gradient */
            transform: skewX(-20deg); /* Angle the shine */
            transition: all 0.5s ease;
        }
        .smart-button:hover::before {
            left: 125%; /* Move across the button to the right */
        }
        /* Disabled state for smart buttons */
        .smart-button:disabled {
            opacity: 0.6; /* Dim the button */
            cursor: not-allowed; /* Change cursor */
            box-shadow: none; /* Remove shadow */
            transform: none; /* Remove lift effect */
            background-color: #a0aec0; /* A neutral gray for disabled */
        }
        .smart-button:disabled:hover::before {
            left: -75%; /* Prevent shine on disabled button */
        }


        /* Specific button colors */
        #addProductBtn { background-color: #10b981; } /* Emerald Green */
        #addProductBtn:hover { background-color: #059669; }
        #addProductBtn:disabled { background-color: #a0aec0; } /* Disabled green */

        #printOrderBtn { background-color: #4c51bf; } /* Indigo */
        #printOrderBtn:hover { background-color: #3b429e; }
        #whatsappShareBtn { background-color: #25d366; } /* WhatsApp Green */
        #whatsappShareBtn:hover { background-color: #1da851; }
        #clearFormBtn { background-color: #6b7280; } /* Gray */
        #clearFormBtn:hover { background-color: #4b5563; }

        .message-box {
            background-color: #e0f7fa; /* Light cyan background */
            color: #006064; /* Dark cyan text */
            padding: 1rem;
            border-radius: 0.75rem;
            margin-top: 1.5rem;
            border: 1px solid #80deea; /* Cyan border */
            text-align: center;
            font-weight: 500;
        }
        .error-message {
            background-color: #ffebee; /* Light red background */
            color: #c62828; /* Dark red text */
            border: 1px solid #ef9a9a; /* Red border */
        }
        .product-row {
            display: flex;
            gap: 1rem;
            align-items: flex-end;
            margin-bottom: 1rem;
        }
        .product-row input[type="text"] {
            flex-grow: 3;
        }
        .product-row input[type="number"] {
            flex-grow: 1;
            max-width: 100px; /* Limit width of quantity field */
        }
        .product-row button {
            flex-shrink: 0;
            padding: 0.75rem 1rem;
            background-color: #ef4444; /* Red for remove button */
        }
        .product-row button:hover {
            background-color: #dc2626;
        }

        /* Autocomplete suggestions styling */
        .product-input-group {
            position: relative; /* Make this the positioning context for suggestions */
        }

        .autocomplete-suggestions {
            position: absolute;
            background-color: white;
            border: 1px solid #cbd5e0;
            border-radius: 0.75rem;
            box-shadow: 0 4px 10px -2px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            max-height: 200px;
            overflow-y: auto;
            z-index: 10;
            /* Adjusted positioning */
            left: 0; /* Align to the left edge of the relative parent */
            width: 100%; /* Take full width of the relative parent */
            top: calc(100% + 0.25rem); /* Position slightly below the input, considering its margin-bottom */
        }
        .autocomplete-suggestions div {
            padding: 0.75rem 1rem;
            cursor: pointer;
            border-bottom: 1px solid #edf2f7; /* Light separator */
        }
        .autocomplete-suggestions div:last-child {
            border-bottom: none;
        }
        .autocomplete-suggestions div:hover {
            background-color: #e3f2fd; /* Lighter blue on hover */
        }

        /* Table specific styles for better readability */
        table {
            border-collapse: separate; /* Allows border-radius on table */
            border-spacing: 0;
        }
        table thead th {
            background-color: #edf2f7; /* Light gray for table header */
            color: #2d3748; /* Darker text */
            font-weight: 700;
            padding: 1rem;
            border-bottom: 2px solid #cbd5e0;
        }
        table tbody td {
            padding: 0.9rem 1rem;
            border-bottom: 1px solid #edf2f7;
            color: #4a5568;
        }
        table tbody tr:last-child td {
            border-bottom: none;
        }
        table tbody tr:hover {
            background-color: #f7fafc; /* Subtle hover effect */
        }
        /* Align specific columns */
        table th:nth-child(1), table td:nth-child(1) { text-align: right; } /* ×©× ×¤×¨×™×˜ */
        table th:nth-child(2), table td:nth-child(2) { text-align: right; } /* ×‘×¨×§×•×“ */
        table th:nth-child(3), table td:nth-child(3) { text-align: center; } /* ×›××•×ª */
        table th:nth-child(4), table td:nth-child(4) { text-align: center; } /* ××©×§×œ ×™×—×™×“×” */
        table th:nth-child(5), table td:nth-child(5) { text-align: center; } /* ×¡×”"×› ××©×§×œ */
        table th:nth-child(6), table td:nth-child(6) { text-align: right; } /* ×”×¢×¨×•×ª ××©×§×œ */
        table th:nth-child(7), table td:nth-child(7) { text-align: center; } /* ×¤×¢×•×œ×•×ª */


        /* Responsive adjustments */
        @media (max-width: 1024px) {
            .container {
                padding: 2rem;
            }
            .grid-cols-1-2-gap-4 {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .product-row {
                flex-direction: column;
                align-items: stretch;
            }
            .product-row input[type="number"] {
                max-width: none; /* Full width on smaller screens */
            }
            .product-row button {
                width: 100%;
            }
            .container {
                padding: 1.5rem;
            }
            h1 {
                font-size: 1.75rem;
            }
            table, thead, tbody, th, td, tr {
                display: block;
            }
            thead tr {
                position: absolute;
                top: -9999px;
                left: -9999px;
            }
            tr { border: 1px solid #ccc; margin-bottom: 0.625em; border-radius: 0.75rem; overflow: hidden; }
            td {
                border: none;
                border-bottom: 1px solid #eee;
                position: relative;
                padding-left: 50%; /* Adjust as needed for label */
                text-align: right;
            }
            td:before {
                position: absolute;
                top: 6px;
                right: 6px;
                width: 45%;
                padding-right: 10px;
                white-space: nowrap;
                font-weight: bold;
            }
            /* Data labels for responsive table */
            td:nth-of-type(1):before { content: "×©× ×¤×¨×™×˜:"; }
            td:nth-of-type(2):before { content: "×‘×¨×§×•×“:"; }
            td:nth-of-type(3):before { content: "×›××•×ª:"; }
            td:nth-of-type(4):before { content: "××©×§×œ ×™×—×™×“×” (×§\"×’):"; }
            td:nth-of-type(5):before { content: "×¡×”\"×› ××©×§×œ (×§\"×’):"; }
            td:nth-of-type(6):before { content: "×”×¢×¨×•×ª ××©×§×œ:"; }
            td:nth-of-type(7):before { content: "×¤×¢×•×œ×•×ª:"; }
        }

        /* Print specific styles */
        @media print {
            body {
                background-color: #ffffff;
                padding: 0;
                margin: 0;
                display: block;
                font-size: 8.5pt; /* Even smaller base font for print */
            }
            .container {
                box-shadow: none;
                border: none;
                padding: 0.15cm; /* Further reduced padding for A4 fit */
                margin: 0.5cm auto; /* Centering the entire print content */
                max-width: 100%;
                width: auto; /* Allow content to dictate width within margins */
            }
            .no-print {
                display: none !important;
            }
            h1 {
                text-align: center; /* Center main heading for print */
                margin-bottom: 8px; /* Reduced margin */
                font-size: 1.5rem; /* Smaller for print */
            }
            h2 {
                text-align: right; /* Align section headings to right for print */
                margin-bottom: 4px; /* Reduced margin */
                font-size: 0.95rem; /* Smaller for print */
                font-weight: 700; /* Ensure bold */
            }
            p {
                margin-bottom: 1px; /* Very tight spacing */
                line-height: 1.1; /* Very tight line height */
            }
            /* Combined details section */
            .order-header-print {
                border: 1px solid #ddd;
                padding: 6px; /* Reduced padding */
                margin-bottom: 8px; /* Reduced margin */
                border-radius: 4px; /* Slightly smaller border radius */
                background-color: #f9f9f9;
            }
            .order-header-print p strong {
                display: inline-block;
                min-width: 60px; /* Further reduced min-width for alignment */
            }
            table {
                border: 1px solid #ddd; /* Add border to the table */
                margin-top: 6px; /* Reduced margin */
            }
            table th, table td {
                border: 1px solid #ddd; /* Add borders to cells */
                padding: 3px; /* Significantly less padding for print */
                vertical-align: top; /* Align text to top in cells */
            }
            .print-table th:nth-child(1), .print-table td:nth-child(1) { text-align: right; } /* ×©× ×¤×¨×™×˜ */
            .print-table th:nth-child(2), .print-table td:nth-child(2) { text-align: right; } /* ×‘×¨×§×•×“ */
            .print-table th:nth-child(3), .print-table td:nth-child(3) { text-align: center; } /* ×›××•×ª */
            .print-table th:nth-child(4), .print-table td:nth-child(4) { text-align: center; } /* ××©×§×œ ×™×—×™×“×” */
            .print-table th:nth-child(5), .print-table td:nth-child(5) { text-align: center; } /* ×¡×”"×› ××©×§×œ */
            .print-table th:nth-child(6), .print-table td:nth-child(6) { text-align: right; } /* ×”×¢×¨×•×ª ××©×§×œ */
            .item-notes-print {
                font-size: 0.8em; /* Smaller font for item notes */
                color: #555;
                margin-top: 2px;
            }

            .summary-box-print {
                border: 1px solid #ddd;
                padding: 6px; /* Reduced padding */
                margin-top: 8px; /* Reduced margin */
                border-radius: 4px;
                background-color: #f9f9f9;
                text-align: right;
            }
            .summary-box-print p {
                margin-bottom: 1px; /* Tighter spacing */
                line-height: 1.1; /* Tighter line height */
                font-size: 0.95rem; /* Smaller font size */
            }
            .general-notes-print {
                margin-top: 15px;
                border: 1px solid #ddd;
                padding: 8px;
                border-radius: 4px;
                background-color: #f9f9f9;
            }
            .general-notes-print p {
                margin-bottom: 0;
            }
            .empty-lines-for-notes {
                border-bottom: 1px dashed #ccc;
                height: 1.2em; /* Height for each line */
                margin-bottom: 0.2em; /* Spacing between lines */
            }
        }

        /* Feedback Pop-up Styles */
        #feedbackPopup {
            position: fixed;
            bottom: 1.5rem;
            right: 1.5rem;
            background-color: #4CAF50; /* Green background */
            color: white;
            padding: 0.75rem 1.25rem;
            border-radius: 0.75rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            opacity: 0; /* Start hidden */
            transform: translateY(20px); /* Start slightly below */
            transition: opacity 0.3s ease-out, transform 0.3s ease-out;
            z-index: 1000;
        }
        #feedbackPopup.show {
            opacity: 1;
            transform: translateY(0);
        }
        #feedbackEmoji {
            font-size: 1.5rem;
            margin-left: 0.5rem;
            animation: spin 1.5s linear infinite; /* Spinning animation */
        }
        #feedbackPopup.success #feedbackEmoji {
            animation: none; /* Stop spin on success */
            content: 'âœ…'; /* Checkmark emoji */
        }
        #feedbackPopup.error {
            background-color: #f44336; /* Red for error */
        }
        #feedbackPopup.error #feedbackEmoji {
            animation: none; /* Stop spin on error */
            content: 'âŒ'; /* Cross emoji */
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-3xl font-bold mb-6">×˜×•×¤×¡ ×”×–×× ×” ×—×“×©×”</h1>

        <!-- Customer Details Section -->
        <div class="mb-6 border-b pb-4 border-gray-200">
            <h2 class="text-xl font-semibold mb-4 text-right">×¤×¨×˜×™ ×œ×§×•×—</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label for="customerName">×©× ×œ×§×•×—:</label>
                    <input type="text" id="customerName" placeholder="×”×›× ×¡ ×©× ×œ×§×•×—">
                </div>
                <div>
                    <label for="contactPerson">××™×© ×§×©×¨:</label>
                    <input type="text" id="contactPerson" placeholder="×”×›× ×¡ ×©× ××™×© ×§×©×¨">
                </div>
                <div>
                    <label for="phoneNumber">××¡×¤×¨ × ×™×™×“:</label>
                    <input type="tel" id="phoneNumber" placeholder="×”×›× ×¡ ××¡×¤×¨ ×˜×œ×¤×•×Ÿ × ×™×™×“">
                </div>
                <div>
                    <label for="email">××™××™×™×œ:</label>
                    <input type="email" id="email" placeholder="×”×›× ×¡ ×›×ª×•×‘×ª ××™××™×™×œ">
                </div>
                <div>
                    <label for="street">×¨×—×•×‘:</label>
                    <input type="text" id="street" placeholder="×”×›× ×¡ ×©× ×¨×—×•×‘">
                </div>
                <div>
                    <label for="streetNumber">××¡×¤×¨ ×¨×—×•×‘:</label>
                    <input type="text" id="streetNumber" placeholder="×”×›× ×¡ ××¡×¤×¨ ×¨×—×•×‘">
                </div>
                <div>
                    <label for="city">×¢×™×¨:</label>
                    <input type="text" id="city" placeholder="×”×›× ×¡ ×¢×™×¨">
                </div>
            </div>
        </div>

        <!-- Delivery Details Section -->
        <div class="mb-6 border-b pb-4 border-gray-200">
            <h2 class="text-xl font-semibold mb-4 text-right">×¤×¨×˜×™ ××¡×¤×§×”</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label for="deliveryDate">×ª××¨×™×š ××¡×¤×§×”:</label>
                    <input type="date" id="deliveryDate">
                </div>
                <div>
                    <label for="deliveryTime">×©×¢×ª ××¡×¤×§×”:</label>
                    <input type="time" id="deliveryTime">
                </div>
                <div>
                    <label for="driverName">×©× × ×”×’ ××ª×•×›× ×Ÿ:</label>
                    <input type="text" id="driverName" placeholder="×”×›× ×¡ ×©× × ×”×’">
                </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mt-4">
                <div class="flex items-center">
                    <input type="checkbox" id="manualUnloading" class="ml-2 rounded text-indigo-600 focus:ring-indigo-500">
                    <label for="manualUnloading" class="mb-0">×¤×¨×™×§×” ×™×“× ×™×ª</label>
                </div>
                <div class="flex items-center">
                    <input type="checkbox" id="crane10m" class="ml-2 rounded text-indigo-600 focus:ring-indigo-500">
                    <label for="crane10m" class="mb-0">×”×•×‘×œ×ª ×× ×•×£ 10 ××˜×¨</label>
                </div>
                <div class="flex items-center">
                    <input type="checkbox" id="crane15m" class="ml-2 rounded text-indigo-600 focus:ring-indigo-500">
                    <label for="crane15m" class="mb-0">×”×•×‘×œ×ª ×× ×•×£ 15 ××˜×¨</label>
                </div>
                <div class="flex items-center">
                    <input type="checkbox" id="craneWork" class="ml-2 rounded text-indigo-600 focus:ring-indigo-500">
                    <label for="craneWork" class="mb-0">×¢×‘×•×“×•×ª ×× ×•×£</label>
                </div>
            </div>
        </div>

        <!-- Product Selection Section -->
        <div class="mb-6 border-b pb-4 border-gray-200">
            <h2 class="text-xl font-semibold mb-4 text-right">×”×•×¡×¤×ª ××•×¦×¨×™×</h2>
            <div class="product-input-group">
                <label for="productSearchInput">×‘×—×¨ ××•×¦×¨ (×”×§×œ×“ 2 ××•×ª×™×•×ª ×œ×—×™×¤×•×©):</label>
                <input type="text" id="productSearchInput" placeholder="×”×§×œ×“ ×©× ××•×¦×¨ ××• ×‘×¨×§×•×“">
                <div id="autocompleteSuggestions" class="autocomplete-suggestions hidden"></div>
            </div>

            <div class="flex items-center gap-4 mt-4">
                <label for="quantity" class="mb-0">×›××•×ª:</label>
                <input type="number" id="quantity" min="1" value="1" class="w-24">
                <button id="addProductBtn" class="smart-button flex-shrink-0" disabled>
                    ×”×•×¡×£ ×¤×¨×™×˜
                </button>
            </div>
        </div>

        <!-- Selected Products Table -->
        <div class="mb-6 border-b pb-4 border-gray-200">
            <h2 class="text-xl font-semibold mb-4 text-right">×¤×¨×™×˜×™× ×‘×”×–×× ×”</h2>
            <table class="min-w-full bg-white border border-gray-300 rounded-lg overflow-hidden">
                <thead>
                    <tr class="bg-gray-100">
                        <th class="py-2 px-4 border-b text-right">×©× ×¤×¨×™×˜</th>
                        <th class="py-2 px-4 border-b text-right">×‘×¨×§×•×“</th>
                        <th class="py-2 px-4 border-b text-center">×›××•×ª</th>
                        <th class="py-2 px-4 border-b text-center">××©×§×œ ×™×—×™×“×” (×§"×’)</th>
                        <th class="py-2 px-4 border-b text-center">×¡×”"×› ××©×§×œ (×§"×’)</th>
                        <th class="py-2 px-4 border-b text-right">×”×¢×¨×•×ª ××©×§×œ</th>
                        <th class="py-2 px-4 border-b text-center no-print">×¤×¢×•×œ×•×ª</th>
                    </tr>
                </thead>
                <tbody id="orderItemsTableBody">
                    <!-- Product rows will be added here by JavaScript -->
                    <tr id="noItemsRow">
                        <td colspan="7" class="text-center py-4 text-gray-500">×¢×“×™×™×Ÿ ×œ× × ×•×¡×¤×• ×¤×¨×™×˜×™× ×œ×”×–×× ×”.</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Weight Summary -->
        <div class="mb-6 border-b pb-4 border-gray-200">
            <h2 class="text-xl font-semibold mb-4 text-right">×¡×™×›×•× ××©×§×œ×™×</h2>
            <p class="text-lg font-bold text-gray-800 text-right">
                ×¡×”"×› ××©×§×œ ×”×–×× ×”: <span id="totalWeightDisplay">0</span> ×§"×’
            </p>
        </div>

        <!-- General Notes Section -->
        <div class="mb-6 border-b pb-4 border-gray-200">
            <label for="generalNotes">×”×¢×¨×•×ª ×›×œ×œ×™×•×ª ×œ×”×–×× ×”:</label>
            <textarea id="generalNotes" rows="3" placeholder="×”×§×œ×“ ×”×¢×¨×•×ª ×›×œ×œ×™×•×ª ×œ×”×–×× ×” ×›××Ÿ..."></textarea>
        </div>

        <!-- Action Buttons -->
        <div class="mt-6 flex flex-col md:flex-row gap-4 no-print">
            <button id="printOrderBtn" class="smart-button flex-1">
                ×”×“×¤×¡×ª ×”×–×× ×”
            </button>
            <button id="whatsappShareBtn" class="smart-button flex-1">
                ×©×™×ª×•×£ ×‘×•×•××˜×¡××¤
            </button>
            <button id="clearFormBtn" class="smart-button flex-1">
                × ×™×§×•×™ ×˜×•×¤×¡
            </button>
        </div>

        <!-- Message Box for user feedback -->
        <div class="message-box mt-6" id="messageBox">
            <p>×”××•×¦×¨×™× ×™×™×˜×¢× ×• ××•×˜×•××˜×™×ª ××’×™×œ×™×•×Ÿ ×”× ×ª×•× ×™×. ×•×•×“× ×©×§×•×‘×¥ Code.gs ×¤×¨×•×¡ ×›-Web App.</p>
        </div>

        <!-- Raw Data for debugging (hidden by default, can be toggled) -->
        <div class="mt-6 hidden">
            <h2 class="text-xl font-semibold mb-2">× ×ª×•× ×™ ××•×¦×¨×™× ×’×•×œ××™×™× (×œ×¦×•×¨×š ×‘×“×™×§×”):</h2>
            <pre id="rawData" class="bg-gray-100 p-4 rounded-lg text-sm overflow-auto max-h-64"></pre>
        </div>

    </div>

    <!-- Feedback Pop-up -->
    <div id="feedbackPopup" class="fixed bottom-4 right-4 bg-green-500 text-white py-2 px-4 rounded-lg shadow-lg hidden items-center" style="z-index: 1000;">
        <span id="feedbackEmoji" class="ml-2"></span>
        <span id="feedbackMessage"></span>
    </div>

    <script>
        // IMPORTANT: Replace this URL with your deployed Google Apps Script Web App URL
        // ×”×•×¨××•×ª ×œ×¤×¨×™×¡×” × ××¦××•×ª ×‘×—×œ×§ ×”×§×•×“× ×©×œ ×”×©×™×—×”
        const googleAppsScriptUrl = 'https://script.google.com/macros/s/AKfycbygjSL2JFpCqMBdSTWAVEeKPD8secghGUxFWNixbXyk1c0Jf74jxwQ41aC_5uz9YA4/exec'; 

        // Global variables
        let allProducts = []; // Stores all products fetched from the sheet
        let selectedProducts = []; // Stores products currently in the order
        let selectedProductForAdd = null; // Stores the currently selected product object from autocomplete

        // DOM elements
        const customerNameInput = document.getElementById('customerName');
        const contactPersonInput = document.getElementById('contactPerson');
        const phoneNumberInput = document.getElementById('phoneNumber');
        const emailInput = document.getElementById('email');
        const streetInput = document.getElementById('street');
        const streetNumberInput = document.getElementById('streetNumber');
        const cityInput = document.getElementById('city');
        const deliveryDateInput = document.getElementById('deliveryDate');
        const deliveryTimeInput = document.getElementById('deliveryTime');
        const driverNameInput = document.getElementById('driverName');
        const manualUnloadingCheckbox = document.getElementById('manualUnloading');
        const crane10mCheckbox = document.getElementById('crane10m');
        const crane15mCheckbox = document.getElementById('crane15m');
        const craneWorkCheckbox = document.getElementById('craneWork');
        const productSearchInput = document.getElementById('productSearchInput');
        const autocompleteSuggestions = document.getElementById('autocompleteSuggestions');
        const quantityInput = document.getElementById('quantity');
        const addProductBtn = document.getElementById('addProductBtn');
        const orderItemsTableBody = document.getElementById('orderItemsTableBody');
        const noItemsRow = document.getElementById('noItemsRow');
        const totalWeightDisplay = document.getElementById('totalWeightDisplay');
        const generalNotesInput = document.getElementById('generalNotes'); // New general notes input
        const printOrderBtn = document.getElementById('printOrderBtn');
        const whatsappShareBtn = document.getElementById('whatsappShareBtn');
        const clearFormBtn = document.getElementById('clearFormBtn');
        const messageBox = document.getElementById('messageBox');
        const rawDataPre = document.getElementById('rawData'); // For debugging raw data
        const feedbackPopup = document.getElementById('feedbackPopup');
        const feedbackEmoji = document.getElementById('feedbackEmoji');
        const feedbackMessage = document.getElementById('feedbackMessage');


        // Function to display messages in the message box
        function displayMessage(message, isError = false) {
            messageBox.textContent = message;
            messageBox.classList.remove('bg-blue-100', 'text-blue-800', 'border-blue-300', 'bg-red-100', 'text-red-800', 'border-red-300', 'error-message', 'bg-cyan-50', 'text-cyan-800', 'border-cyan-200');
            if (isError) {
                messageBox.classList.add('bg-red-100', 'text-red-800', 'border-red-300', 'error-message');
            } else {
                messageBox.classList.add('bg-cyan-50', 'text-cyan-800', 'border-cyan-200'); // Updated to a more pleasant light blue/cyan
            }
        }

        // Function to show visual feedback pop-up
        function showFeedbackMessage(message, type = 'success') { // type can be 'success', 'error', 'loading'
            feedbackMessage.textContent = message;
            feedbackPopup.classList.remove('success', 'error', 'loading', 'hidden');
            feedbackEmoji.style.animation = 'none'; // Reset animation

            if (type === 'success') {
                feedbackPopup.classList.add('success');
                feedbackEmoji.textContent = 'âœ…';
            } else if (type === 'error') {
                feedbackPopup.classList.add('error');
                feedbackEmoji.textContent = 'âŒ';
            } else if (type === 'loading') {
                feedbackPopup.classList.add('loading');
                feedbackEmoji.textContent = 'âš™ï¸'; // Gear emoji for loading
                feedbackEmoji.style.animation = 'spin 1.5s linear infinite';
            }

            feedbackPopup.classList.add('show');

            // Hide after 3 seconds for success/error, keep loading until explicitly hidden
            if (type !== 'loading') {
                setTimeout(() => {
                    feedbackPopup.classList.remove('show');
                    setTimeout(() => feedbackPopup.classList.add('hidden'), 300); // Fully hide after transition
                }, 3000);
            }
        }

        function hideFeedbackMessage() {
            feedbackPopup.classList.remove('show');
            setTimeout(() => feedbackPopup.classList.add('hidden'), 300); // Fully hide after transition
        }


        // --- Product Fetching ---
        async function fetchProducts() {
            showFeedbackMessage('×˜×•×¢×Ÿ ××•×¦×¨×™×...', 'loading');
            try {
                const response = await fetch(googleAppsScriptUrl);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();

                rawDataPre.textContent = JSON.stringify(data, null, 2); // Display raw data for debugging

                if (data && data.products && Array.isArray(data.products) && data.products.length > 0) {
                    allProducts = data.products; // Store all fetched products
                    console.log('All Products fetched successfully. Total products:', allProducts.length, allProducts);
                    showFeedbackMessage('×”××•×¦×¨×™× × ×˜×¢× ×• ×‘×”×¦×œ×—×”!', 'success');
                } else {
                    showFeedbackMessage('×œ× × ××¦××• ××•×¦×¨×™× ×‘×’×™×œ×™×•×Ÿ ×”× ×ª×•× ×™× ××• ×©×”×¤×•×¨××˜ ××™× ×• ×ª×§×™×Ÿ.', 'error');
                    console.error('No products found or invalid format:', data);
                }
            } catch (error) {
                console.error('×©×’×™××” ×‘×˜×¢×™× ×ª ××•×¦×¨×™×:', error);
                showFeedbackMessage(`×©×’×™××” ×‘×˜×¢×™× ×ª ××•×¦×¨×™×: ${error.message}. ×•×•×“× ×©×›×ª×•×‘×ª ×”-URL × ×›×•× ×” ×•×©×”×¡×§×¨×™×¤×˜ ×¤×¨×•×¡ ×›×¨××•×™.`, 'error');
            }
        }

        // --- Autocomplete Logic ---
        productSearchInput.addEventListener('input', () => {
            const searchTerm = productSearchInput.value.trim();
            autocompleteSuggestions.innerHTML = ''; // Clear previous suggestions
            autocompleteSuggestions.classList.add('hidden');
            selectedProductForAdd = null; // Reset selected product when typing
            addProductBtn.disabled = true; // Disable add button until a product is selected

            // Activate search only after 2 or more characters
            if (searchTerm.length >= 2) {
                const lowerCaseSearchTerm = searchTerm.toLowerCase();

                const filteredProducts = allProducts.filter(product => {
                    const itemName = String(product.itemName || '').toLowerCase();
                    const barcode = String(product.barcode || '').toLowerCase();
                    
                    return itemName.includes(lowerCaseSearchTerm) || barcode.includes(lowerCaseSearchTerm);
                });

                if (filteredProducts.length > 0) {
                    autocompleteSuggestions.classList.remove('hidden');
                    filteredProducts.forEach(product => {
                        const suggestionDiv = document.createElement('div');
                        suggestionDiv.textContent = `${product.itemName} (×‘×¨×§×•×“: ${product.barcode})`;
                        suggestionDiv.dataset.product = JSON.stringify(product); 
                        
                        suggestionDiv.addEventListener('click', () => {
                            const selectedProductData = JSON.parse(suggestionDiv.dataset.product);
                            productSearchInput.value = selectedProductData.itemName; // Set input value
                            selectedProductForAdd = selectedProductData; // Store the full product object
                            autocompleteSuggestions.classList.add('hidden'); // Hide suggestions
                            addProductBtn.disabled = false; // Enable add button when a product is selected
                        });
                        autocompleteSuggestions.appendChild(suggestionDiv);
                    });
                }
            }
        });

        // Hide suggestions when clicking outside
        document.addEventListener('click', (event) => {
            if (!productSearchInput.contains(event.target) && !autocompleteSuggestions.contains(event.target)) {
                autocompleteSuggestions.classList.add('hidden');
            }
        });

        // --- Add Product to Order ---
        addProductBtn.addEventListener('click', () => {
            const productToAdd = selectedProductForAdd; // Use the globally stored selected product
            const quantity = parseInt(quantityInput.value, 10);

            if (!productToAdd) {
                showFeedbackMessage('×× × ×‘×—×¨ ××•×¦×¨ ××”×¨×©×™××” ××• ×”×§×œ×“ ×©× ××•×¦×¨ ×ª×§×™×Ÿ.', 'error');
                return;
            }
            if (isNaN(quantity) || quantity <= 0) {
                showFeedbackMessage('×× × ×”×–×Ÿ ×›××•×ª ×—×•×§×™×ª (××¡×¤×¨ ×’×“×•×œ ×-0).', 'error');
                return;
            }

            // Check if product already exists in the order
            const existingProductIndex = selectedProducts.findIndex(p => p.barcode === productToAdd.barcode);

            if (existingProductIndex > -1) {
                // Update quantity if product already exists
                selectedProducts[existingProductIndex].quantity += quantity;
            } else {
                // Add new product, initialize notes to empty string
                selectedProducts.push({
                    itemName: productToAdd.itemName,
                    barcode: productToAdd.barcode,
                    quantity: quantity,
                    itemNotes: '' // New: Initialize itemNotes
                });
            }

            renderOrderItems();
            calculateTotalWeight();
            productSearchInput.value = ''; // Clear input
            selectedProductForAdd = null; // Clear selected product after adding
            addProductBtn.disabled = true; // Disable add button again
            quantityInput.value = 1; // Reset quantity
            showFeedbackMessage('×”×¤×¨×™×˜ × ×•×¡×£ ×‘×”×¦×œ×—×”!', 'success');
        });

        // --- Render Order Items Table ---
        function renderOrderItems() {
            orderItemsTableBody.innerHTML = ''; // Clear current table content

            if (selectedProducts.length === 0) {
                noItemsRow.style.display = 'table-row'; // Show "no items" row
                orderItemsTableBody.appendChild(noItemsRow);
                return;
            } else {
                noItemsRow.style.display = 'none'; // Hide "no items" row
            }

            selectedProducts.forEach((product, index) => {
                const { unitWeight, weightNotes } = calculateProductWeight(product.itemName);
                const totalProductWeight = unitWeight * product.quantity;

                const row = document.createElement('tr');
                row.classList.add('border-b');
                row.innerHTML = `
                    <td class="py-2 px-4 border-b">${product.itemName}</td>
                    <td class="py-2 px-4 border-b">${product.barcode}</td>
                    <td class="py-2 px-4 border-b text-center">${product.quantity}</td>
                    <td class="py-2 px-4 border-b text-center">${unitWeight}</td>
                    <td class="py-2 px-4 border-b text-center">${totalProductWeight.toFixed(2)}</td>
                    <td class="py-2 px-4 border-b">
                        ${weightNotes}
                        <textarea data-index="${index}" class="item-notes-input w-full mt-1 p-1 text-sm border rounded-md focus:ring-indigo-500 focus:border-indigo-500" rows="1" placeholder="×”×¢×¨×•×ª ×œ×¤×¨×™×˜..." oninput="updateItemNotes(this)">${product.itemNotes || ''}</textarea>
                    </td>
                    <td class="py-2 px-4 border-b no-print text-center">
                        <button data-index="${index}" class="remove-item-btn bg-red-500 hover:bg-red-700 text-white text-sm py-1 px-2 rounded-md">×”×¡×¨</button>
                    </td>
                `;
                orderItemsTableBody.appendChild(row);
            });

            // Add event listeners for remove buttons
            document.querySelectorAll('.remove-item-btn').forEach(button => {
                button.addEventListener('click', (event) => {
                    const indexToRemove = parseInt(event.target.dataset.index, 10);
                    selectedProducts.splice(indexToRemove, 1); // Remove item from array
                    renderOrderItems(); // Re-render table
                    calculateTotalWeight(); // Recalculate total weight
                    showFeedbackMessage('×”×¤×¨×™×˜ ×”×•×¡×¨ ×‘×”×¦×œ×—×”.', 'success');
                });
            });
        }

        // Function to update item notes when textarea changes
        function updateItemNotes(textareaElement) {
            const index = parseInt(textareaElement.dataset.index, 10);
            if (selectedProducts[index]) {
                selectedProducts[index].itemNotes = textareaElement.value;
            }
        }
        window.updateItemNotes = updateItemNotes; // Make it globally accessible for oninput

        // --- Weight Calculation Logic ---
        // Assumption: 1 cubic meter of "×©×§ ×’×“×•×œ" (large bag) is approximately 1000 kg (water density).
        // So, half a cubic meter (×—×¦×™ ×§×•×‘) is 500 kg.
        function calculateProductWeight(itemName) {
            let unitWeight = 0;
            let weightNotes = '';

            if (itemName.includes('×©×§ ×’×“×•×œ')) {
                unitWeight = 500; // Half a cubic meter assumed to be 500 kg
                weightNotes = '××©×§×œ ××©×•×¢×¨: ×—×¦×™ ×§×•×‘';
            } else if (itemName.includes('25 ×§"×’')) {
                unitWeight = 25;
                weightNotes = '××©×§×œ ×©×§';
            } else if (itemName.includes('××©×˜×—')) {
                // "××©×˜×—" is a note, not a specific weight contribution unless specified further
                weightNotes = '×¤×¨×™×˜ ×¢×œ ××©×˜×—';
                // If a default pallet weight is needed, define it here. For now, 0.
                unitWeight = 0;
            }
            // Add more conditions for other product types/weights as needed
            // Example for a product with a specific weight:
            // else if (itemName.includes('××•×¦×¨ X')) {
            //     unitWeight = 10; // Example: 10 kg for product X
            //     weightNotes = '××©×§×œ ×¡×¤×¦×™×¤×™ ×œ××•×¦×¨ X';
            // }

            return { unitWeight, weightNotes };
        }

        function calculateTotalWeight() {
            let totalWeight = 0;
            selectedProducts.forEach(product => {
                const { unitWeight } = calculateProductWeight(product.itemName);
                totalWeight += unitWeight * product.quantity;
            });
            totalWeightDisplay.textContent = totalWeight.toFixed(2);
        }

        // --- Clear Form ---
        clearFormBtn.addEventListener('click', () => {
            // Clear customer details
            customerNameInput.value = '';
            contactPersonInput.value = '';
            phoneNumberInput.value = '';
            streetInput.value = '';
            streetNumberInput.value = '';
            cityInput.value = '';
            emailInput.value = '';

            // Clear delivery details
            deliveryDateInput.value = '';
            deliveryTimeInput.value = '';
            driverNameInput.value = '';

            // Uncheck all delivery checkboxes
            manualUnloadingCheckbox.checked = false;
            crane10mCheckbox.checked = false;
            crane15mCheckbox.checked = false;
            craneWorkCheckbox.checked = false;

            // Clear product selection and order items
            productSearchInput.value = '';
            selectedProductForAdd = null;
            addProductBtn.disabled = true;
            quantityInput.value = 1;
            selectedProducts = [];
            renderOrderItems();
            calculateTotalWeight();
            generalNotesInput.value = ''; // Clear general notes
            showFeedbackMessage('×”×˜×•×¤×¡ × ×•×§×” ×‘×”×¦×œ×—×”.', 'success');
        });

        // --- Print Order ---
        printOrderBtn.addEventListener('click', () => {
            // Collect all form data
            const customerName = customerNameInput.value;
            const contactPerson = contactPersonInput.value;
            const phoneNumber = phoneNumberInput.value;
            const street = streetInput.value;
            const streetNumber = streetNumberInput.value;
            const city = cityInput.value;
            const email = emailInput.value;
            const deliveryDate = deliveryDateInput.value;
            const deliveryTime = deliveryTimeInput.value;
            const driverName = driverNameInput.value;
            const generalNotes = generalNotesInput.value; // Get general notes

            const deliveryTypes = [];
            if (manualUnloadingCheckbox.checked) deliveryTypes.push('×¤×¨×™×§×” ×™×“× ×™×ª');
            if (crane10mCheckbox.checked) deliveryTypes.push('×”×•×‘×œ×ª ×× ×•×£ 10 ××˜×¨');
            if (crane15mCheckbox.checked) deliveryTypes.push('×”×•×‘×œ×ª ×× ×•×£ 15 ××˜×¨');
            if (craneWorkCheckbox.checked) deliveryTypes.push('×¢×‘×•×“×•×ª ×× ×•×£');

            let totalQuantity = 0;
            selectedProducts.forEach(product => {
                totalQuantity += product.quantity;
            });

            const now = new Date();
            const formCreationTimestamp = now.toLocaleString('he-IL', {
                year: 'numeric', month: 'numeric', day: 'numeric',
                hour: '2-digit', minute: '2-digit', second: '2-digit',
                hour12: false
            });

            let orderDetailsHtml = `
                <!DOCTYPE html>
                <html lang="he" dir="rtl">
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>×”×–×× ×ª ×œ×§×•×—</title>
                    <style>
                        body { font-family: 'Inter', sans-serif; margin: 0.5cm; direction: rtl; text-align: right; color: #333; font-size: 8.5pt; }
                        h1 { color: #1a202c; margin-bottom: 8px; text-align: center; font-weight: 700; font-size: 1.5rem; }
                        h2 { color: #1a202c; margin-bottom: 4px; text-align: right; font-weight: 700; font-size: 0.95rem; }
                        p { margin-bottom: 1px; line-height: 1.1; }
                        .order-header-print {
                            border: 1px solid #ddd;
                            padding: 6px;
                            margin-bottom: 8px;
                            border-radius: 4px;
                            background-color: #f9f9f9;
                        }
                        .order-header-print p strong {
                            display: inline-block;
                            min-width: 60px;
                        }
                        table { width: 100%; border-collapse: collapse; margin-top: 6px; border: 1px solid #ddd; }
                        th, td { border: 1px solid #ddd; padding: 3px; text-align: right; vertical-align: top; }
                        th { background-color: #f8f8f8; font-weight: 600; }
                        .text-center { text-align: center; }
                        .text-right { text-align: right; }
                        .font-bold { font-weight: bold; }
                        .item-notes-print { font-size: 0.8em; color: #555; margin-top: 2px; }
                        .summary-box-print {
                            border: 1px solid #ddd;
                            padding: 6px;
                            margin-top: 8px;
                            border-radius: 4px;
                            background-color: #f9f9f9;
                            text-align: right;
                        }
                        .summary-box-print p { margin-bottom: 1px; line-height: 1.1; font-size: 0.95rem; }
                        .general-notes-print { margin-top: 15px; border: 1px solid #ddd; padding: 8px; border-radius: 4px; background-color: #f9f9f9; }
                        .general-notes-print p { margin-bottom: 0; }
                        .empty-lines-for-notes {
                            border-bottom: 1px dashed #ccc;
                            height: 1.2em; /* Height for each line */
                            margin-bottom: 0.2em; /* Spacing between lines */
                        }
                    </style>
                </head>
                <body>
                    <h1>×”×–×× ×” ×—×“×©×”</h1>
                    <div class="order-header-print">
                        <h2>×¤×¨×˜×™ ×”×–×× ×”: ğŸ‘¤ğŸšš</h2>
                        <p><strong>×œ×§×•×—:</strong> ${customerName || '×œ× ×”×•×–×Ÿ'} (××™×© ×§×©×¨: ${contactPerson || '×œ× ×”×•×–×Ÿ'})</p>
                        <p><strong>× ×™×™×“:</strong> ${phoneNumber || '×œ× ×”×•×–×Ÿ'} | <strong>××™××™×™×œ:</strong> ${email || '×œ× ×”×•×–×Ÿ'}</p>
                        <p><strong>×›×ª×•×‘×ª:</strong> ${street || ''} ${streetNumber || ''}, ${city || '×œ× ×”×•×–×Ÿ'}</p>
                        <p><strong>×ª××¨×™×š ××¡×¤×§×”:</strong> ${deliveryDate || '×œ× ×”×•×–×Ÿ'} | <strong>×©×¢×ª ××¡×¤×§×”:</strong> ${deliveryTime || '×œ× ×”×•×–×Ÿ'}</p>
                        <p><strong>× ×”×’ ××ª×•×›× ×Ÿ:</strong> ${driverName || '×œ× ×”×•×–×Ÿ'}</p>
                        <p><strong>×¡×•×’ ×”×•×‘×œ×”:</strong> ${deliveryTypes.length > 0 ? deliveryTypes.join(', ') : '×œ× × ×‘×—×¨'}</p>
                        <p><strong>×–××Ÿ ×”×§××ª ×˜×•×¤×¡:</strong> ${formCreationTimestamp}</p>
                    </div>

                    <h2>×¤×¨×™×˜×™× ×‘×”×–×× ×”: ğŸ“¦</h2>
                    <table>
                        <thead>
                            <tr>
                                <th>×©× ×¤×¨×™×˜</th>
                                <th>×‘×¨×§×•×“</th>
                                <th class="text-center">×›××•×ª</th>
                                <th class="text-center">××©×§×œ ×™×—×™×“×” (×§"×’)</th>
                                <th class="text-center">×¡×”"×› ××©×§×œ (×§"×’)</th>
                                <th>×”×¢×¨×•×ª ××©×§×œ</th>
                            </tr>
                        </thead>
                        <tbody>
            `;

            if (selectedProducts.length === 0) {
                orderDetailsHtml += `<tr><td colspan="6" class="text-center text-gray-500">×œ× × ×•×¡×¤×• ×¤×¨×™×˜×™× ×œ×”×–×× ×”.</td></tr>`;
            } else {
                selectedProducts.forEach(product => {
                    const { unitWeight, weightNotes } = calculateProductWeight(product.itemName);
                    const totalProductWeight = unitWeight * product.quantity;
                    orderDetailsHtml += `
                        <tr>
                            <td>${product.itemName}</td>
                            <td>${product.barcode}</td>
                            <td class="text-center">${product.quantity}</td>
                            <td class="text-center">${unitWeight}</td>
                            <td class="text-center">${totalProductWeight.toFixed(2)}</td>
                            <td>
                                ${weightNotes}
                                ${product.itemNotes ? `<div class="item-notes-print">×”×¢×¨×”: ${product.itemNotes}</div>` : ''}
                            </td>
                        </tr>
                    `;
                });
            }

            orderDetailsHtml += `
                            </tbody>
                        </table>
                    <div class="summary-box-print">
                        <h2>×¡×™×›×•× ×”×–×× ×”:</h2>
                        <p class="font-bold">×¡×”"×› ×›××•×ª ×¤×¨×™×˜×™×: ${totalQuantity}</p>
                        <p class="font-bold">×¡×”"×› ××©×§×œ ×”×–×× ×”: ${totalWeightDisplay.textContent} ×§"×’</p>
                    </div>
                    ${generalNotes ? `<div class="general-notes-print"><h2>×”×¢×¨×•×ª ×›×œ×œ×™×•×ª:</h2><p>${generalNotes}</p></div>` : ''}
                    <div class="general-notes-print">
                        <h2>×”×¢×¨×•×ª (×œ×›×ª×™×‘×” ×™×“× ×™×ª):</h2>
                        <div class="empty-lines-for-notes"></div>
                        <div class="empty-lines-for-notes"></div>
                        <div class="empty-lines-for-notes"></div>
                        <div class="empty-lines-for-notes"></div>
                    </div>
                </body>
                </html>
            `;

            const printWindow = window.open('', '_blank');
            printWindow.document.write(orderDetailsHtml);
            printWindow.document.close(); // Close the document to ensure content is rendered
            printWindow.focus(); // Focus on the new window
            printWindow.print(); // Trigger print
            // printWindow.close(); // Optional: Close window after printing (might be too fast)
        });

        // --- WhatsApp Share ---
        whatsappShareBtn.addEventListener('click', () => {
            const phoneNumberWhatsapp = '972508860896'; // The specific WhatsApp number for sending

            // Collect all form data for the message
            const customerName = customerNameInput.value;
            const contactPerson = contactPersonInput.value;
            const phoneNumber = phoneNumberInput.value;
            const street = streetInput.value;
            const streetNumber = streetNumberInput.value;
            const city = cityInput.value;
            const email = emailInput.value;
            const deliveryDate = deliveryDateInput.value;
            const deliveryTime = deliveryTimeInput.value;
            const driverName = driverNameInput.value;
            const generalNotes = generalNotesInput.value; // Get general notes for WhatsApp

            const deliveryTypes = [];
            if (manualUnloadingCheckbox.checked) deliveryTypes.push('×¤×¨×™×§×” ×™×“× ×™×ª');
            if (crane10mCheckbox.checked) deliveryTypes.push('×”×•×‘×œ×ª ×× ×•×£ 10 ××˜×¨');
            if (crane15mCheckbox.checked) deliveryTypes.push('×”×•×‘×œ×ª ×× ×•×£ 15 ××˜×¨');
            if (craneWorkCheckbox.checked) deliveryTypes.push('×¢×‘×•×“×•×ª ×× ×•×£');

            let totalQuantity = 0;
            selectedProducts.forEach(product => {
                totalQuantity += product.quantity;
            });

            const now = new Date();
            const formCreationTimestamp = now.toLocaleString('he-IL', {
                year: 'numeric', month: 'numeric', day: 'numeric',
                hour: '2-digit', minute: '2-digit', second: '2-digit',
                hour12: false
            });

            let message = `*×”×–×× ×” ×—×“×©×”*\n\n`;
            message += `*×¤×¨×˜×™ ×œ×§×•×—:*\n`;
            message += `×©× ×œ×§×•×—: ${customerName || '×œ× ×”×•×–×Ÿ'}\n`;
            message += `××™×© ×§×©×¨: ${contactPerson || '×œ× ×”×•×–×Ÿ'}\n`;
            message += `××¡×¤×¨ × ×™×™×“: ${phoneNumber || '×œ× ×”×•×–×Ÿ'}\n`;
            message += `×›×ª×•×‘×ª: ${street || ''} ${streetNumber || ''}, ${city || '×œ× ×”×•×–×Ÿ'}\n`;
            message += `××™××™×™×œ: ${email || '×œ× ×”×•×–×Ÿ'}\n\n`;

            message += `*×¤×¨×˜×™ ××¡×¤×§×”:*\n`;
            message += `×ª××¨×™×š ××¡×¤×§×”: ${deliveryDate || '×œ× ×”×•×–×Ÿ'}\n`;
            message += `×©×¢×ª ××¡×¤×§×”: ${deliveryTime || '×œ× ×”×•×–×Ÿ'}\n`;
            message += `×©× × ×”×’ ××ª×•×›× ×Ÿ: ${driverName || '×œ× ×”×•×–×Ÿ'}\n`;
            message += `×¡×•×’ ×”×•×‘×œ×”: ${deliveryTypes.length > 0 ? deliveryTypes.join(', ') : '×œ× × ×‘×—×¨ ×¡×•×’ ×”×•×‘×œ×”'}\n\n`;
            message += `×–××Ÿ ×”×§××ª ×˜×•×¤×¡: ${formCreationTimestamp}\n\n`;

            message += `*×¤×¨×™×˜×™× ×‘×”×–×× ×”:*\n`;
            if (selectedProducts.length === 0) {
                message += `×œ× × ×•×¡×¤×• ×¤×¨×™×˜×™× ×œ×”×–×× ×”.\n`;
            } else {
                selectedProducts.forEach(product => {
                    const { unitWeight, weightNotes } = calculateProductWeight(product.itemName);
                    const totalProductWeight = totalProductWeight = unitWeight * product.quantity;
                    message += `- ${product.itemName} (×‘×¨×§×•×“: ${product.barcode}), ×›××•×ª: ${product.quantity}, ××©×§×œ ×™×—×™×“×”: ${unitWeight} ×§"×’, ×¡×”"×› ××©×§×œ: ${totalProductWeight.toFixed(2)} ×§"×’ (${weightNotes})`;
                    if (product.itemNotes) {
                        message += ` (×”×¢×¨×”: ${product.itemNotes})`;
                    }
                    message += `\n`;
                });
            }
            message += `\n*×¡×”"×› ×›××•×ª ×¤×¨×™×˜×™×:* ${totalQuantity}`;
            message += `\n*×¡×”"×› ××©×§×œ ×”×–×× ×”:* ${totalWeightDisplay.textContent} ×§"×’`;
            if (generalNotes) {
                message += `\n\n*×”×¢×¨×•×ª ×›×œ×œ×™×•×ª:*\n${generalNotes}`;
            }

            // Encode the message for URL
            const encodedMessage = encodeURIComponent(message);
            const whatsappUrl = `https://wa.me/${phoneNumberWhatsapp}?text=${encodedMessage}`;

            // Open WhatsApp in a new tab
            window.open(whatsappUrl, '_blank');
        });

        // --- Enter Key Navigation ---
        document.addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                const focusableElements = Array.from(
                    document.querySelectorAll(
                        'input:not([type="hidden"]):not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled])'
                    )
                );
                const currentFocusedElement = document.activeElement;
                const currentIndex = focusableElements.indexOf(currentFocusedElement);

                if (currentIndex > -1) {
                    event.preventDefault(); // Prevent default Enter behavior (e.g., form submission)

                    let nextIndex = currentIndex + 1;
                    // Skip the "Add Product" button if no product is selected
                    if (currentFocusedElement === quantityInput && !selectedProductForAdd) {
                        // Find the next focusable element after addProductBtn
                        let tempIndex = focusableElements.indexOf(addProductBtn);
                        if (tempIndex > -1) {
                            nextIndex = tempIndex + 1;
                        }
                    }

                    if (nextIndex < focusableElements.length) {
                        focusableElements[nextIndex].focus();
                    } else {
                        // If at the end, focus on the first element or a specific one
                        focusableElements[0].focus();
                    }
                }
            }
        });


        // --- Initial Load ---
        document.addEventListener('DOMContentLoaded', () => {
            // Check if the Apps Script URL is set
            if (googleAppsScriptUrl === 'YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL_HERE') {
                displayMessage('×× × ×”×—×œ×£ ××ª YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL_HERE ×‘×›×ª×•×‘×ª ×”-URL ×©×œ ×”-Web App ×©×œ×š ×‘-Code.gs.', true);
            } else {
                fetchProducts(); // Fetch products when the page loads
            }
            renderOrderItems(); // Render initial empty table
            calculateTotalWeight(); // Calculate initial total weight (should be 0)

            // Set today's date as default for delivery date
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0'); // Months are 0-indexed
            const day = String(today.getDate()).padStart(2, '0');
            deliveryDateInput.value = `${year}-${month}-${day}`;
        });
    </script>
</body>
</html>

            background-color: #f0f4f8; /* Very light blue-gray background */
            display: flex;
            justify-content: center;
            align-items: flex-start; /* Align to top for better content flow */
            min-height: 100vh; /* Full viewport height */
            padding: 2rem; /* Padding around the content */
            direction: rtl; /* Ensure RTL for the entire body */
        }
        .container {
            background-color: #ffffff; /* White background for the form container */
            padding: 3rem; /* Increased padding */
            border-radius: 1.5rem; /* More rounded corners */
            box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.15), 0 8px 16px -5px rgba(0, 0, 0, 0.08); /* More pronounced shadow */
            max-width: 1200px; /* Increased max width for larger page */
            width: 100%;
            text-align: right; /* Align text to the right for RTL */
            border: 1px solid #e2e8f0; /* Light border for the container */
        }
        h1, h2 {
            color: #1a202c; /* Darker gray for headings */
            margin-bottom: 1.5rem;
            text-align: center; /* Center headings */
            font-weight: 700; /* Bolder headings */
        }
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600; /* Bolder labels */
            color: #2d3748; /* Medium dark gray for labels */
        }
        input[type="text"], input[type="number"], input[type="email"], input[type="tel"], input[type="date"], input[type="time"], select {
            width: 100%;
            padding: 0.85rem; /* Slightly more padding */
            margin-bottom: 1rem;
            border: 1px solid #cbd5e0; /* Slightly darker light gray border */
            border-radius: 0.75rem; /* More rounded corners for inputs */
            font-size: 1rem;
            color: #4a5568; /* Darker gray for input text */
            background-color: #f7fafc; /* Slightly off-white background */
            transition: border-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        input[type="text"]:focus, input[type="number"]:focus, input[type="email"]:focus, input[type="tel"]:focus, input[type="date"]:focus, input[type="time"]:focus, select:focus {
            border-color: #4c51bf; /* Deeper indigo border on focus */
            box-shadow: 0 0 0 4px rgba(76, 81, 191, 0.25); /* More prominent focus ring */
            outline: none;
        }

        /* Smart Button Styling with Shine Effect */
        .smart-button {
            position: relative;
            overflow: hidden;
            background-color: #4c51bf; /* Deeper indigo button */
            color: white;
            padding: 0.9rem 2rem; /* Larger padding */
            border-radius: 0.75rem; /* More rounded corners */
            font-weight: 600;
            transition: background-color 0.3s ease-in-out, box-shadow 0.3s ease-in-out, transform 0.1s ease-out, opacity 0.3s ease-in-out; /* Added opacity for disabled state */
            cursor: pointer;
            border: none;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); /* Default shadow */
        }
        .smart-button:hover {
            background-color: #3b429e; /* Even darker indigo on hover */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.15), 0 4px 6px -2px rgba(0, 0, 0, 0.08); /* Larger shadow on hover */
            transform: translateY(-2px); /* Slight lift effect */
        }
        .smart-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -75%; /* Start off-screen to the left */
            width: 50%; /* Width of the shine */
            height: 100%;
            background: linear-gradient(to right, rgba(255,255,255,0) 0%, rgba(255,255,255,.3) 100%); /* White to transparent gradient */
            transform: skewX(-20deg); /* Angle the shine */
            transition: all 0.5s ease;
        }
        .smart-button:hover::before {
            left: 125%; /* Move across the button to the right */
        }
        /* Disabled state for smart buttons */
        .smart-button:disabled {
            opacity: 0.6; /* Dim the button */
            cursor: not-allowed; /* Change cursor */
            box-shadow: none; /* Remove shadow */
            transform: none; /* Remove lift effect */
            background-color: #a0aec0; /* A neutral gray for disabled */
        }
        .smart-button:disabled:hover::before {
            left: -75%; /* Prevent shine on disabled button */
        }


        /* Specific button colors */
        #addProductBtn { background-color: #10b981; } /* Emerald Green */
        #addProductBtn:hover { background-color: #059669; }
        #addProductBtn:disabled { background-color: #a0aec0; } /* Disabled green */

        #printOrderBtn { background-color: #4c51bf; } /* Indigo */
        #printOrderBtn:hover { background-color: #3b429e; }
        #whatsappShareBtn { background-color: #25d366; } /* WhatsApp Green */
        #whatsappShareBtn:hover { background-color: #1da851; }
        #clearFormBtn { background-color: #6b7280; } /* Gray */
        #clearFormBtn:hover { background-color: #4b5563; }

        .message-box {
            background-color: #e0f7fa; /* Light cyan background */
            color: #006064; /* Dark cyan text */
            padding: 1rem;
            border-radius: 0.75rem;
            margin-top: 1.5rem;
            border: 1px solid #80deea; /* Cyan border */
            text-align: center;
            font-weight: 500;
        }
        .error-message {
            background-color: #ffebee; /* Light red background */
            color: #c62828; /* Dark red text */
            border: 1px solid #ef9a9a; /* Red border */
        }
        .product-row {
            display: flex;
            gap: 1rem;
            align-items: flex-end;
            margin-bottom: 1rem;
        }
        .product-row input[type="text"] {
            flex-grow: 3;
        }
        .product-row input[type="number"] {
            flex-grow: 1;
            max-width: 100px; /* Limit width of quantity field */
        }
        .product-row button {
            flex-shrink: 0;
            padding: 0.75rem 1rem;
            background-color: #ef4444; /* Red for remove button */
        }
        .product-row button:hover {
            background-color: #dc2626;
        }

        /* Autocomplete suggestions styling */
        .product-input-group {
            position: relative; /* Make this the positioning context for suggestions */
        }

        .autocomplete-suggestions {
            position: absolute;
            background-color: white;
            border: 1px solid #cbd5e0;
            border-radius: 0.75rem;
            box-shadow: 0 4px 10px -2px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            max-height: 200px;
            overflow-y: auto;
            z-index: 10;
            /* Adjusted positioning */
            left: 0; /* Align to the left edge of the relative parent */
            width: 100%; /* Take full width of the relative parent */
            top: calc(100% + 0.25rem); /* Position slightly below the input, considering its margin-bottom */
        }
        .autocomplete-suggestions div {
            padding: 0.75rem 1rem;
            cursor: pointer;
            border-bottom: 1px solid #edf2f7; /* Light separator */
        }
        .autocomplete-suggestions div:last-child {
            border-bottom: none;
        }
        .autocomplete-suggestions div:hover {
            background-color: #e3f2fd; /* Lighter blue on hover */
        }

        /* Table specific styles for better readability */
        table {
            border-collapse: separate; /* Allows border-radius on table */
            border-spacing: 0;
        }
        table thead th {
            background-color: #edf2f7; /* Light gray for table header */
            color: #2d3748; /* Darker text */
            font-weight: 700;
            padding: 1rem;
            border-bottom: 2px solid #cbd5e0;
        }
        table tbody td {
            padding: 0.9rem 1rem;
            border-bottom: 1px solid #edf2f7;
            color: #4a5568;
        }
        table tbody tr:last-child td {
            border-bottom: none;
        }
        table tbody tr:hover {
            background-color: #f7fafc; /* Subtle hover effect */
        }
        /* Align specific columns */
        table th:nth-child(1), table td:nth-child(1) { text-align: right; } /* ×©× ×¤×¨×™×˜ */
        table th:nth-child(2), table td:nth-child(2) { text-align: right; } /* ×‘×¨×§×•×“ */
        table th:nth-child(3), table td:nth-child(3) { text-align: center; } /* ×›××•×ª */
        table th:nth-child(4), table td:nth-child(4) { text-align: center; } /* ××©×§×œ ×™×—×™×“×” */
        table th:nth-child(5), table td:nth-child(5) { text-align: center; } /* ×¡×”"×› ××©×§×œ */
        table th:nth-child(6), table td:nth-child(6) { text-align: right; } /* ×”×¢×¨×•×ª ××©×§×œ */
        table th:nth-child(7), table td:nth-child(7) { text-align: center; } /* ×¤×¢×•×œ×•×ª */


        /* Responsive adjustments */
        @media (max-width: 1024px) {
            .container {
                padding: 2rem;
            }
            .grid-cols-1-2-gap-4 {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .product-row {
                flex-direction: column;
                align-items: stretch;
            }
            .product-row input[type="number"] {
                max-width: none; /* Full width on smaller screens */
            }
            .product-row button {
                width: 100%;
            }
            .container {
                padding: 1.5rem;
            }
            h1 {
                font-size: 1.75rem;
            }
            table, thead, tbody, th, td, tr {
                display: block;
            }
            thead tr {
                position: absolute;
                top: -9999px;
                left: -9999px;
            }
            tr { border: 1px solid #ccc; margin-bottom: 0.625em; border-radius: 0.75rem; overflow: hidden; }
            td {
                border: none;
                border-bottom: 1px solid #eee;
                position: relative;
                padding-left: 50%; /* Adjust as needed for label */
                text-align: right;
            }
            td:before {
                position: absolute;
                top: 6px;
                right: 6px;
                width: 45%;
                padding-right: 10px;
                white-space: nowrap;
                font-weight: bold;
            }
            /* Data labels for responsive table */
            td:nth-of-type(1):before { content: "×©× ×¤×¨×™×˜:"; }
            td:nth-of-type(2):before { content: "×‘×¨×§×•×“:"; }
            td:nth-of-type(3):before { content: "×›××•×ª:"; }
            td:nth-of-type(4):before { content: "××©×§×œ ×™×—×™×“×” (×§\"×’):"; }
            td:nth-of-type(5):before { content: "×¡×”\"×› ××©×§×œ (×§\"×’):"; }
            td:nth-of-type(6):before { content: "×”×¢×¨×•×ª ××©×§×œ:"; }
            td:nth-of-type(7):before { content: "×¤×¢×•×œ×•×ª:"; }
        }

        /* Print specific styles */
        @media print {
            body {
                background-color: #ffffff;
                padding: 0;
                margin: 0;
                display: block;
                font-size: 9pt; /* Smaller base font for print */
            }
            .container {
                box-shadow: none;
                border: none;
                padding: 0.2cm; /* Significantly reduced padding for A4 fit */
                margin: 0.5cm; /* Small margin around the entire print content */
                max-width: 100%;
                width: auto; /* Allow content to dictate width within margins */
            }
            .no-print {
                display: none !important;
            }
            h1 {
                text-align: center; /* Center main heading for print */
                margin-bottom: 10px; /* Reduced margin */
                font-size: 1.6rem; /* Smaller for print */
            }
            h2 {
                text-align: right; /* Align section headings to right for print */
                margin-bottom: 5px; /* Reduced margin */
                font-size: 1rem; /* Smaller for print */
            }
            .customer-details-print, .delivery-details-print, .summary-box-print {
                border: 1px solid #ddd;
                padding: 8px; /* Significantly reduced padding */
                margin-bottom: 10px; /* Reduced margin */
                border-radius: 5px; /* Slightly smaller border radius */
                background-color: #f9f9f9;
            }
            .customer-details-print p, .delivery-details-print p {
                margin-bottom: 2px; /* Tighter spacing */
                line-height: 1.2; /* Tighter line height */
            }
            .customer-details-print p strong, .delivery-details-print p strong {
                display: inline-block; /* Ensure strong stays inline with text */
                min-width: 70px; /* Further reduced min-width for alignment */
            }
            table {
                border: 1px solid #ddd; /* Add border to the table */
                margin-top: 8px; /* Reduced margin */
            }
            table th, table td {
                border: 1px solid #ddd; /* Add borders to cells */
                padding: 4px; /* Significantly less padding for print */
            }
            .print-table th:nth-child(1), .print-table td:nth-child(1) { text-align: right; } /* ×©× ×¤×¨×™×˜ */
            .print-table th:nth-child(2), .print-table td:nth-child(2) { text-align: right; } /* ×‘×¨×§×•×“ */
            .print-table th:nth-child(3), .print-table td:nth-child(3) { text-align: center; } /* ×›××•×ª */
            .print-table th:nth-child(4), .print-table td:nth-child(4) { text-align: center; } /* ××©×§×œ ×™×—×™×“×” */
            .print-table th:nth-child(5), .print-table td:nth-child(5) { text-align: center; } /* ×¡×”"×› ××©×§×œ */
            .print-table th:nth-child(6), .print-table td:nth-child(6) { text-align: right; } /* ×”×¢×¨×•×ª ××©×§×œ */

            .summary-box-print {
                padding: 8px; /* Reduced padding */
                margin-top: 10px; /* Reduced margin */
            }
            .summary-box-print p {
                margin-bottom: 2px; /* Tighter spacing */
                line-height: 1.2; /* Tighter line height */
                font-size: 1rem; /* Slightly smaller font size */
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-3xl font-bold mb-6">×˜×•×¤×¡ ×”×–×× ×” ×—×“×©×”</h1>

        <!-- Customer Details Section -->
        <div class="mb-6 border-b pb-4 border-gray-200">
            <h2 class="text-xl font-semibold mb-4 text-right">×¤×¨×˜×™ ×œ×§×•×—</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label for="customerName">×©× ×œ×§×•×—:</label>
                    <input type="text" id="customerName" placeholder="×”×›× ×¡ ×©× ×œ×§×•×—">
                </div>
                <div>
                    <label for="contactPerson">××™×© ×§×©×¨:</label>
                    <input type="text" id="contactPerson" placeholder="×”×›× ×¡ ×©× ××™×© ×§×©×¨">
                </div>
                <div>
                    <label for="phoneNumber">××¡×¤×¨ × ×™×™×“:</label>
                    <input type="tel" id="phoneNumber" placeholder="×”×›× ×¡ ××¡×¤×¨ ×˜×œ×¤×•×Ÿ × ×™×™×“">
                </div>
                <div>
                    <label for="email">××™××™×™×œ:</label>
                    <input type="email" id="email" placeholder="×”×›× ×¡ ×›×ª×•×‘×ª ××™××™×™×œ">
                </div>
                <div>
                    <label for="street">×¨×—×•×‘:</label>
                    <input type="text" id="street" placeholder="×”×›× ×¡ ×©× ×¨×—×•×‘">
                </div>
                <div>
                    <label for="streetNumber">××¡×¤×¨ ×¨×—×•×‘:</label>
                    <input type="text" id="streetNumber" placeholder="×”×›× ×¡ ××¡×¤×¨ ×¨×—×•×‘">
                </div>
                <div>
                    <label for="city">×¢×™×¨:</label>
                    <input type="text" id="city" placeholder="×”×›× ×¡ ×¢×™×¨">
                </div>
            </div>
        </div>

        <!-- Delivery Details Section -->
        <div class="mb-6 border-b pb-4 border-gray-200">
            <h2 class="text-xl font-semibold mb-4 text-right">×¤×¨×˜×™ ××¡×¤×§×”</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label for="deliveryDate">×ª××¨×™×š ××¡×¤×§×”:</label>
                    <input type="date" id="deliveryDate">
                </div>
                <div>
                    <label for="deliveryTime">×©×¢×ª ××¡×¤×§×”:</label>
                    <input type="time" id="deliveryTime">
                </div>
                <div>
                    <label for="driverName">×©× × ×”×’ ××ª×•×›× ×Ÿ:</label>
                    <input type="text" id="driverName" placeholder="×”×›× ×¡ ×©× × ×”×’">
                </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mt-4">
                <div class="flex items-center">
                    <input type="checkbox" id="manualUnloading" class="ml-2 rounded text-indigo-600 focus:ring-indigo-500">
                    <label for="manualUnloading" class="mb-0">×¤×¨×™×§×” ×™×“× ×™×ª</label>
                </div>
                <div class="flex items-center">
                    <input type="checkbox" id="crane10m" class="ml-2 rounded text-indigo-600 focus:ring-indigo-500">
                    <label for="crane10m" class="mb-0">×”×•×‘×œ×ª ×× ×•×£ 10 ××˜×¨</label>
                </div>
                <div class="flex items-center">
                    <input type="checkbox" id="crane15m" class="ml-2 rounded text-indigo-600 focus:ring-indigo-500">
                    <label for="crane15m" class="mb-0">×”×•×‘×œ×ª ×× ×•×£ 15 ××˜×¨</label>
                </div>
                <div class="flex items-center">
                    <input type="checkbox" id="craneWork" class="ml-2 rounded text-indigo-600 focus:ring-indigo-500">
                    <label for="craneWork" class="mb-0">×¢×‘×•×“×•×ª ×× ×•×£</label>
                </div>
            </div>
        </div>

        <!-- Product Selection Section -->
        <div class="mb-6 border-b pb-4 border-gray-200">
            <h2 class="text-xl font-semibold mb-4 text-right">×”×•×¡×¤×ª ××•×¦×¨×™×</h2>
            <div class="product-input-group">
                <label for="productSearchInput">×‘×—×¨ ××•×¦×¨ (×”×§×œ×“ 2 ××•×ª×™×•×ª ×œ×—×™×¤×•×©):</label>
                <input type="text" id="productSearchInput" placeholder="×”×§×œ×“ ×©× ××•×¦×¨ ××• ×‘×¨×§×•×“">
                <div id="autocompleteSuggestions" class="autocomplete-suggestions hidden"></div>
            </div>

            <div class="flex items-center gap-4 mt-4">
                <label for="quantity" class="mb-0">×›××•×ª:</label>
                <input type="number" id="quantity" min="1" value="1" class="w-24">
                <button id="addProductBtn" class="smart-button flex-shrink-0" disabled>
                    ×”×•×¡×£ ×¤×¨×™×˜
                </button>
            </div>
        </div>

        <!-- Selected Products Table -->
        <div class="mb-6 border-b pb-4 border-gray-200">
            <h2 class="text-xl font-semibold mb-4 text-right">×¤×¨×™×˜×™× ×‘×”×–×× ×”</h2>
            <table class="min-w-full bg-white border border-gray-300 rounded-lg overflow-hidden">
                <thead>
                    <tr class="bg-gray-100">
                        <th class="py-2 px-4 border-b text-right">×©× ×¤×¨×™×˜</th>
                        <th class="py-2 px-4 border-b text-right">×‘×¨×§×•×“</th>
                        <th class="py-2 px-4 border-b text-center">×›××•×ª</th>
                        <th class="py-2 px-4 border-b text-center">××©×§×œ ×™×—×™×“×” (×§"×’)</th>
                        <th class="py-2 px-4 border-b text-center">×¡×”"×› ××©×§×œ (×§"×’)</th>
                        <th class="py-2 px-4 border-b text-right">×”×¢×¨×•×ª ××©×§×œ</th>
                        <th class="py-2 px-4 border-b text-center no-print">×¤×¢×•×œ×•×ª</th>
                    </tr>
                </thead>
                <tbody id="orderItemsTableBody">
                    <!-- Product rows will be added here by JavaScript -->
                    <tr id="noItemsRow">
                        <td colspan="7" class="text-center py-4 text-gray-500">×¢×“×™×™×Ÿ ×œ× × ×•×¡×¤×• ×¤×¨×™×˜×™× ×œ×”×–×× ×”.</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Weight Summary -->
        <div class="mb-6 border-b pb-4 border-gray-200">
            <h2 class="text-xl font-semibold mb-4 text-right">×¡×™×›×•× ××©×§×œ×™×</h2>
            <p class="text-lg font-bold text-gray-800 text-right">
                ×¡×”"×› ××©×§×œ ×”×–×× ×”: <span id="totalWeightDisplay">0</span> ×§"×’
            </p>
        </div>

        <!-- Action Buttons -->
        <div class="mt-6 flex flex-col md:flex-row gap-4 no-print">
            <button id="printOrderBtn" class="smart-button flex-1">
                ×”×“×¤×¡×ª ×”×–×× ×”
            </button>
            <button id="whatsappShareBtn" class="smart-button flex-1">
                ×©×™×ª×•×£ ×‘×•×•××˜×¡××¤
            </button>
            <button id="clearFormBtn" class="smart-button flex-1">
                × ×™×§×•×™ ×˜×•×¤×¡
            </button>
        </div>

        <!-- Message Box for user feedback -->
        <div class="message-box mt-6" id="messageBox">
            <p>×”××•×¦×¨×™× ×™×™×˜×¢× ×• ××•×˜×•××˜×™×ª ××’×™×œ×™×•×Ÿ ×”× ×ª×•× ×™×. ×•×•×“× ×©×§×•×‘×¥ Code.gs ×¤×¨×•×¡ ×›-Web App.</p>
        </div>

        <!-- Raw Data for debugging (hidden by default, can be toggled) -->
        <div class="mt-6 hidden">
            <h2 class="text-xl font-semibold mb-2">× ×ª×•× ×™ ××•×¦×¨×™× ×’×•×œ××™×™× (×œ×¦×•×¨×š ×‘×“×™×§×”):</h2>
            <pre id="rawData" class="bg-gray-100 p-4 rounded-lg text-sm overflow-auto max-h-64"></pre>
        </div>

    </div>

    <script>
        // IMPORTANT: Replace this URL with your deployed Google Apps Script Web App URL
        // ×”×•×¨××•×ª ×œ×¤×¨×™×¡×” × ××¦××•×ª ×‘×—×œ×§ ×”×§×•×“× ×©×œ ×”×©×™×—×”
        const googleAppsScriptUrl = 'https://script.google.com/macros/s/AKfycbygjSL2JFpCqMBdSTWAVEeKPD8secghGUxFWNixbXyk1c0Jf74jxwQ41aC_5uz9YA4/exec'; 

        // Global variables
        let allProducts = []; // Stores all products fetched from the sheet
        let selectedProducts = []; // Stores products currently in the order
        let selectedProductForAdd = null; // Stores the currently selected product object from autocomplete

        // DOM elements
        const productSearchInput = document.getElementById('productSearchInput');
        const autocompleteSuggestions = document.getElementById('autocompleteSuggestions');
        const quantityInput = document.getElementById('quantity');
        const addProductBtn = document.getElementById('addProductBtn');
        const orderItemsTableBody = document.getElementById('orderItemsTableBody');
        const noItemsRow = document.getElementById('noItemsRow');
        const totalWeightDisplay = document.getElementById('totalWeightDisplay');
        const printOrderBtn = document.getElementById('printOrderBtn');
        const whatsappShareBtn = document.getElementById('whatsappShareBtn');
        const clearFormBtn = document.getElementById('clearFormBtn');
        const messageBox = document.getElementById('messageBox');
        const rawDataPre = document.getElementById('rawData'); // For debugging raw data

        // New DOM elements for delivery details
        const deliveryDateInput = document.getElementById('deliveryDate');
        const deliveryTimeInput = document.getElementById('deliveryTime');
        const phoneNumberInput = document.getElementById('phoneNumber');
        const driverNameInput = document.getElementById('driverName'); // New driver name input

        // Function to display messages in the message box
        function displayMessage(message, isError = false) {
            messageBox.textContent = message;
            messageBox.classList.remove('bg-blue-100', 'text-blue-800', 'border-blue-300', 'bg-red-100', 'text-red-800', 'border-red-300', 'error-message', 'bg-cyan-50', 'text-cyan-800', 'border-cyan-200');
            if (isError) {
                messageBox.classList.add('bg-red-100', 'text-red-800', 'border-red-300', 'error-message');
            } else {
                messageBox.classList.add('bg-cyan-50', 'text-cyan-800', 'border-cyan-200'); // Updated to a more pleasant light blue/cyan
            }
        }

        // --- Product Fetching ---
        async function fetchProducts() {
            displayMessage('×˜×•×¢×Ÿ ××•×¦×¨×™× ××’×™×œ×™×•×Ÿ ×”× ×ª×•× ×™×...');
            try {
                const response = await fetch(googleAppsScriptUrl);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();

                rawDataPre.textContent = JSON.stringify(data, null, 2); // Display raw data for debugging

                if (data && data.products && Array.isArray(data.products) && data.products.length > 0) {
                    allProducts = data.products; // Store all fetched products
                    console.log('All Products fetched successfully. Total products:', allProducts.length, allProducts); // New debug log: Check this in browser console!
                    displayMessage('×”××•×¦×¨×™× × ×˜×¢× ×• ×‘×”×¦×œ×—×”!');
                } else {
                    displayMessage('×œ× × ××¦××• ××•×¦×¨×™× ×‘×’×™×œ×™×•×Ÿ ×”× ×ª×•× ×™× ××• ×©×”×¤×•×¨××˜ ××™× ×• ×ª×§×™×Ÿ.', true);
                    console.error('No products found or invalid format:', data); // Debugging: Log the problematic data
                }
            } catch (error) {
                console.error('×©×’×™××” ×‘×˜×¢×™× ×ª ××•×¦×¨×™×:', error);
                displayMessage(`×©×’×™××” ×‘×˜×¢×™× ×ª ××•×¦×¨×™×: ${error.message}. ×•×•×“× ×©×›×ª×•×‘×ª ×”-URL × ×›×•× ×” ×•×©×”×¡×§×¨×™×¤×˜ ×¤×¨×•×¡ ×›×¨××•×™.`, true);
            }
        }

        // --- Autocomplete Logic ---
        productSearchInput.addEventListener('input', () => {
            const searchTerm = productSearchInput.value.trim();
            autocompleteSuggestions.innerHTML = ''; // Clear previous suggestions
            autocompleteSuggestions.classList.add('hidden');
            selectedProductForAdd = null; // Reset selected product when typing
            addProductBtn.disabled = true; // Disable add button until a product is selected

            // Activate search only after 2 or more characters
            if (searchTerm.length >= 2) {
                console.log('Autocomplete: Search Term:', searchTerm);
                console.log('Autocomplete: Total products available for filter:', allProducts.length);

                const lowerCaseSearchTerm = searchTerm.toLowerCase();

                const filteredProducts = allProducts.filter(product => {
                    // Ensure product.itemName and product.barcode are strings before calling toLowerCase() and includes()
                    const itemName = String(product.itemName || '').toLowerCase();
                    const barcode = String(product.barcode || '').toLowerCase();
                    
                    return itemName.includes(lowerCaseSearchTerm) || barcode.includes(lowerCaseSearchTerm);
                });

                console.log('Autocomplete: Filtered Products:', filteredProducts);

                if (filteredProducts.length > 0) {
                    autocompleteSuggestions.classList.remove('hidden');
                    filteredProducts.forEach(product => {
                        const suggestionDiv = document.createElement('div');
                        suggestionDiv.textContent = `${product.itemName} (×‘×¨×§×•×“: ${product.barcode})`;
                        // Store the full product object in the dataset for easy retrieval
                        suggestionDiv.dataset.product = JSON.stringify(product); 
                        
                        suggestionDiv.addEventListener('click', () => {
                            const selectedProductData = JSON.parse(suggestionDiv.dataset.product);
                            productSearchInput.value = selectedProductData.itemName; // Set input value
                            selectedProductForAdd = selectedProductData; // Store the full product object
                            autocompleteSuggestions.classList.add('hidden'); // Hide suggestions
                            addProductBtn.disabled = false; // Enable add button when a product is selected
                            console.log('Autocomplete: Product selected:', selectedProductForAdd);
                        });
                        autocompleteSuggestions.appendChild(suggestionDiv);
                    });
                }
            }
        });

        // Hide suggestions when clicking outside
        document.addEventListener('click', (event) => {
            if (!productSearchInput.contains(event.target) && !autocompleteSuggestions.contains(event.target)) {
                autocompleteSuggestions.classList.add('hidden');
            }
        });

        // --- Add Product to Order ---
        addProductBtn.addEventListener('click', () => {
            const productToAdd = selectedProductForAdd; // Use the globally stored selected product
            const quantity = parseInt(quantityInput.value, 10);

            if (!productToAdd) {
                displayMessage('×× × ×‘×—×¨ ××•×¦×¨ ××”×¨×©×™××” ××• ×”×§×œ×“ ×©× ××•×¦×¨ ×ª×§×™×Ÿ.', true);
                return;
            }
            if (isNaN(quantity) || quantity <= 0) {
                displayMessage('×× × ×”×–×Ÿ ×›××•×ª ×—×•×§×™×ª (××¡×¤×¨ ×’×“×•×œ ×-0).', true);
                return;
            }

            // Check if product already exists in the order
            const existingProductIndex = selectedProducts.findIndex(p => p.barcode === productToAdd.barcode);

            if (existingProductIndex > -1) {
                // Update quantity if product already exists
                selectedProducts[existingProductIndex].quantity += quantity;
            } else {
                // Add new product
                selectedProducts.push({
                    itemName: productToAdd.itemName,
                    barcode: productToAdd.barcode,
                    quantity: quantity
                });
            }

            renderOrderItems();
            calculateTotalWeight();
            productSearchInput.value = ''; // Clear input
            selectedProductForAdd = null; // Clear selected product after adding
            addProductBtn.disabled = true; // Disable add button again
            quantityInput.value = 1; // Reset quantity
            displayMessage('×”×¤×¨×™×˜ × ×•×¡×£ ×‘×”×¦×œ×—×”!');
        });

        // --- Render Order Items Table ---
        function renderOrderItems() {
            orderItemsTableBody.innerHTML = ''; // Clear current table content

            if (selectedProducts.length === 0) {
                noItemsRow.style.display = 'table-row'; // Show "no items" row
                orderItemsTableBody.appendChild(noItemsRow);
                return;
            } else {
                noItemsRow.style.display = 'none'; // Hide "no items" row
            }

            selectedProducts.forEach((product, index) => {
                const { unitWeight, weightNotes } = calculateProductWeight(product.itemName);
                const totalProductWeight = unitWeight * product.quantity;

                const row = document.createElement('tr');
                row.classList.add('border-b');
                row.innerHTML = `
                    <td class="py-2 px-4 border-b">${product.itemName}</td>
                    <td class="py-2 px-4 border-b">${product.barcode}</td>
                    <td class="py-2 px-4 border-b text-center">${product.quantity}</td>
                    <td class="py-2 px-4 border-b text-center">${unitWeight}</td>
                    <td class="py-2 px-4 border-b text-center">${totalProductWeight.toFixed(2)}</td>
                    <td class="py-2 px-4 border-b">${weightNotes}</td>
                    <td class="py-2 px-4 border-b no-print text-center">
                        <button data-index="${index}" class="remove-item-btn bg-red-500 hover:bg-red-700 text-white text-sm py-1 px-2 rounded-md">×”×¡×¨</button>
                    </td>
                `;
                orderItemsTableBody.appendChild(row);
            });

            // Add event listeners for remove buttons
            document.querySelectorAll('.remove-item-btn').forEach(button => {
                button.addEventListener('click', (event) => {
                    const indexToRemove = parseInt(event.target.dataset.index, 10);
                    selectedProducts.splice(indexToRemove, 1); // Remove item from array
                    renderOrderItems(); // Re-render table
                    calculateTotalWeight(); // Recalculate total weight
                    displayMessage('×”×¤×¨×™×˜ ×”×•×¡×¨ ×‘×”×¦×œ×—×”.');
                });
            });
        }

        // --- Weight Calculation Logic ---
        // Assumption: 1 cubic meter of "×©×§ ×’×“×•×œ" (large bag) is approximately 1000 kg (water density).
        // So, half a cubic meter (×—×¦×™ ×§×•×‘) is 500 kg.
        function calculateProductWeight(itemName) {
            let unitWeight = 0;
            let weightNotes = '';

            if (itemName.includes('×©×§ ×’×“×•×œ')) {
                unitWeight = 500; // Half a cubic meter assumed to be 500 kg
                weightNotes = '××©×§×œ ××©×•×¢×¨: ×—×¦×™ ×§×•×‘';
            } else if (itemName.includes('25 ×§"×’')) {
                unitWeight = 25;
                weightNotes = '××©×§×œ ×©×§';
            } else if (itemName.includes('××©×˜×—')) {
                // "××©×˜×—" is a note, not a specific weight contribution unless specified further
                weightNotes = '×¤×¨×™×˜ ×¢×œ ××©×˜×—';
                // If a default pallet weight is needed, define it here. For now, 0.
                unitWeight = 0;
            }
            // Add more conditions for other product types/weights as needed
            // Example for a product with a specific weight:
            // else if (itemName.includes('××•×¦×¨ X')) {
            //     unitWeight = 10; // Example: 10 kg for product X
            //     weightNotes = '××©×§×œ ×¡×¤×¦×™×¤×™ ×œ××•×¦×¨ X';
            // }

            return { unitWeight, weightNotes };
        }

        function calculateTotalWeight() {
            let totalWeight = 0;
            selectedProducts.forEach(product => {
                const { unitWeight } = calculateProductWeight(product.itemName);
                totalWeight += unitWeight * product.quantity;
            });
            totalWeightDisplay.textContent = totalWeight.toFixed(2);
        }

        // --- Clear Form ---
        clearFormBtn.addEventListener('click', () => {
            // Clear customer details
            document.getElementById('customerName').value = '';
            document.getElementById('contactPerson').value = '';
            phoneNumberInput.value = ''; // Clear new phone number field
            document.getElementById('street').value = '';
            document.getElementById('streetNumber').value = '';
            document.getElementById('city').value = '';
            document.getElementById('email').value = '';

            // Clear delivery details
            deliveryDateInput.value = '';
            deliveryTimeInput.value = '';
            driverNameInput.value = ''; // Clear new driver name field

            // Uncheck all delivery checkboxes
            document.getElementById('manualUnloading').checked = false;
            document.getElementById('crane10m').checked = false;
            document.getElementById('crane15m').checked = false;
            document.getElementById('craneWork').checked = false;

            // Clear product selection and order items
            productSearchInput.value = '';
            selectedProductForAdd = null; // Clear selected product
            addProductBtn.disabled = true; // Disable add button
            quantityInput.value = 1;
            selectedProducts = [];
            renderOrderItems();
            calculateTotalWeight();
            displayMessage('×”×˜×•×¤×¡ × ×•×§×” ×‘×”×¦×œ×—×”.');
        });

        // --- Print Order ---
        printOrderBtn.addEventListener('click', () => {
            // Collect all form data
            const customerName = document.getElementById('customerName').value;
            const contactPerson = document.getElementById('contactPerson').value;
            const phoneNumber = phoneNumberInput.value; // Get phone number
            const street = document.getElementById('street').value;
            const streetNumber = document.getElementById('streetNumber').value;
            const city = document.getElementById('city').value;
            const email = document.getElementById('email').value;
            const deliveryDate = deliveryDateInput.value; // Get delivery date
            const deliveryTime = deliveryTimeInput.value; // Get delivery time
            const driverName = driverNameInput.value; // Get driver name

            const deliveryTypes = [];
            if (document.getElementById('manualUnloading').checked) deliveryTypes.push('×¤×¨×™×§×” ×™×“× ×™×ª');
            if (document.getElementById('crane10m').checked) deliveryTypes.push('×”×•×‘×œ×ª ×× ×•×£ 10 ××˜×¨');
            if (document.getElementById('crane15m').checked) deliveryTypes.push('×”×•×‘×œ×ª ×× ×•×£ 15 ××˜×¨');
            if (document.getElementById('craneWork').checked) deliveryTypes.push('×¢×‘×•×“×•×ª ×× ×•×£');

            let totalQuantity = 0;
            selectedProducts.forEach(product => {
                totalQuantity += product.quantity;
            });

            let orderDetailsHtml = `
                <!DOCTYPE html>
                <html lang="he" dir="rtl">
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>×”×–×× ×ª ×œ×§×•×—</title>
                    <style>
                        body { font-family: 'Inter', sans-serif; margin: 0.5cm; direction: rtl; text-align: right; color: #333; font-size: 9pt; }
                        h1 { color: #1a202c; margin-bottom: 10px; text-align: center; font-weight: 700; font-size: 1.6rem; }
                        h2 { color: #1a202c; margin-bottom: 5px; text-align: right; font-weight: 700; font-size: 1rem; }
                        p { margin-bottom: 2px; line-height: 1.2; }
                        .customer-details-print, .delivery-details-print, .summary-box-print {
                            border: 1px solid #ddd;
                            padding: 8px;
                            margin-bottom: 10px;
                            border-radius: 5px;
                            background-color: #f9f9f9;
                        }
                        .customer-details-print p strong, .delivery-details-print p strong {
                            display: inline-block;
                            min-width: 70px;
                        }
                        table { width: 100%; border-collapse: collapse; margin-top: 8px; border: 1px solid #ddd; }
                        th, td { border: 1px solid #ddd; padding: 4px; text-align: right; }
                        th { background-color: #f8f8f8; font-weight: 600; }
                        .text-center { text-align: center; }
                        .text-right { text-align: right; }
                        .font-bold { font-weight: bold; }
                        .text-lg { font-size: 1.125rem; }
                        .text-xl { font-size: 1.25rem; }
                        .text-2xl { font-size: 1.5rem; }
                        .text-gray-500 { color: #6b7280; }
                    </style>
                </head>
                <body>
                    <h1>×”×–×× ×” ×—×“×©×”</h1>
                    <div class="customer-details-print">
                        <h2>×¤×¨×˜×™ ×œ×§×•×—: ğŸ‘¤</h2>
                        <p><strong>×©× ×œ×§×•×—:</strong> ${customerName || '×œ× ×”×•×–×Ÿ'}</p>
                        <p><strong>××™×© ×§×©×¨:</strong> ${contactPerson || '×œ× ×”×•×–×Ÿ'}</p>
                        <p><strong>××¡×¤×¨ × ×™×™×“:</strong> ${phoneNumber || '×œ× ×”×•×–×Ÿ'}</p>
                        <p><strong>××™××™×™×œ:</strong> ${email || '×œ× ×”×•×–×Ÿ'}</p>
                        <p><strong>×›×ª×•×‘×ª:</strong> ${street || ''} ${streetNumber || ''}, ${city || '×œ× ×”×•×–×Ÿ'}</p>
                    </div>
                    
                    <div class="delivery-details-print">
                        <h2>×¤×¨×˜×™ ××¡×¤×§×”: ğŸšš</h2>
                        <p><strong>×ª××¨×™×š ××¡×¤×§×”:</strong> ${deliveryDate || '×œ× ×”×•×–×Ÿ'}</p>
                        <p><strong>×©×¢×ª ××¡×¤×§×”:</strong> ${deliveryTime || '×œ× ×”×•×–×Ÿ'}</p>
                        <p><strong>×©× × ×”×’ ××ª×•×›× ×Ÿ:</strong> ${driverName || '×œ× ×”×•×–×Ÿ'}</p>
                        <p><strong>×¡×•×’ ×”×•×‘×œ×”:</strong> ${deliveryTypes.length > 0 ? deliveryTypes.join(', ') : '×œ× × ×‘×—×¨ ×¡×•×’ ×”×•×‘×œ×”'}</p>
                    </div>

                    <h2>×¤×¨×™×˜×™× ×‘×”×–×× ×”: ğŸ“¦</h2>
                    <table>
                        <thead>
                            <tr>
                                <th>×©× ×¤×¨×™×˜</th>
                                <th>×‘×¨×§×•×“</th>
                                <th class="text-center">×›××•×ª</th>
                                <th class="text-center">××©×§×œ ×™×—×™×“×” (×§"×’)</th>
                                <th class="text-center">×¡×”"×› ××©×§×œ (×§"×’)</th>
                                <th>×”×¢×¨×•×ª ××©×§×œ</th>
                            </tr>
                        </thead>
                        <tbody>
            `;

            if (selectedProducts.length === 0) {
                orderDetailsHtml += `<tr><td colspan="6" class="text-center text-gray-500">×œ× × ×•×¡×¤×• ×¤×¨×™×˜×™× ×œ×”×–×× ×”.</td></tr>`;
            } else {
                selectedProducts.forEach(product => {
                    const { unitWeight, weightNotes } = calculateProductWeight(product.itemName);
                    const totalProductWeight = unitWeight * product.quantity;
                    orderDetailsHtml += `
                        <tr>
                            <td>${product.itemName}</td>
                            <td>${product.barcode}</td>
                            <td class="text-center">${product.quantity}</td>
                            <td class="text-center">${unitWeight}</td>
                            <td class="text-center">${totalProductWeight.toFixed(2)}</td>
                            <td>${weightNotes}</td>
                        </tr>
                    `;
                });
            }

            orderDetailsHtml += `
                            </tbody>
                        </table>
                    <div class="summary-box-print">
                        <h2>×¡×™×›×•× ×”×–×× ×”:</h2>
                        <p class="font-bold">×¡×”"×› ×›××•×ª ×¤×¨×™×˜×™×: ${totalQuantity}</p>
                        <p class="font-bold">×¡×”"×› ××©×§×œ ×”×–×× ×”: ${totalWeightDisplay.textContent} ×§"×’</p>
                    </div>
                </body>
                </html>
            `;

            const printWindow = window.open('', '_blank');
            printWindow.document.write(orderDetailsHtml);
            printWindow.document.close(); // Close the document to ensure content is rendered
            printWindow.focus(); // Focus on the new window
            printWindow.print(); // Trigger print
            // printWindow.close(); // Optional: Close window after printing (might be too fast)
        });

        // --- WhatsApp Share ---
        whatsappShareBtn.addEventListener('click', () => {
            const phoneNumberWhatsapp = '972508860896'; // The specific WhatsApp number for sending

            // Collect all form data for the message
            const customerName = document.getElementById('customerName').value;
            const contactPerson = document.getElementById('contactPerson').value;
            const phoneNumber = phoneNumberInput.value; // Get phone number
            const street = document.getElementById('street').value;
            const streetNumber = document.getElementById('streetNumber').value;
            const city = document.getElementById('city').value;
            const email = document.getElementById('email').value;
            const deliveryDate = deliveryDateInput.value; // Get delivery date
            const deliveryTime = deliveryTimeInput.value; // Get delivery time
            const driverName = driverNameInput.value; // Get driver name


            const deliveryTypes = [];
            if (document.getElementById('manualUnloading').checked) deliveryTypes.push('×¤×¨×™×§×” ×™×“× ×™×ª');
            if (document.getElementById('crane10m').checked) deliveryTypes.push('×”×•×‘×œ×ª ×× ×•×£ 10 ××˜×¨');
            if (document.getElementById('crane15m').checked) deliveryTypes.push('×”×•×‘×œ×ª ×× ×•×£ 15 ××˜×¨');
            if (document.getElementById('craneWork').checked) deliveryTypes.push('×¢×‘×•×“×•×ª ×× ×•×£');

            let totalQuantity = 0;
            selectedProducts.forEach(product => {
                totalQuantity += product.quantity;
            });

            let message = `*×”×–×× ×” ×—×“×©×”*\n\n`;
            message += `*×¤×¨×˜×™ ×œ×§×•×—:*\n`;
            message += `×©× ×œ×§×•×—: ${customerName || '×œ× ×”×•×–×Ÿ'}\n`;
            message += `××™×© ×§×©×¨: ${contactPerson || '×œ× ×”×•×–×Ÿ'}\n`;
            message += `××¡×¤×¨ × ×™×™×“: ${phoneNumber || '×œ× ×”×•×–×Ÿ'}\n`;
            message += `×›×ª×•×‘×ª: ${street || ''} ${streetNumber || ''}, ${city || '×œ× ×”×•×–×Ÿ'}\n`;
            message += `××™××™×™×œ: ${email || '×œ× ×”×•×–×Ÿ'}\n\n`;

            message += `*×¤×¨×˜×™ ××¡×¤×§×”:*\n`;
            message += `×ª××¨×™×š ××¡×¤×§×”: ${deliveryDate || '×œ× ×”×•×–×Ÿ'}\n`;
            message += `×©×¢×ª ××¡×¤×§×”: ${deliveryTime || '×œ× ×”×•×–×Ÿ'}\n`;
            message += `×©× × ×”×’ ××ª×•×›× ×Ÿ: ${driverName || '×œ× ×”×•×–×Ÿ'}\n`;
            message += `×¡×•×’ ×”×•×‘×œ×”: ${deliveryTypes.length > 0 ? deliveryTypes.join(', ') : '×œ× × ×‘×—×¨ ×¡×•×’ ×”×•×‘×œ×”'}\n\n`;

            message += `*×¤×¨×™×˜×™× ×‘×”×–×× ×”:*\n`;
            if (selectedProducts.length === 0) {
                message += `×œ× × ×•×¡×¤×• ×¤×¨×™×˜×™× ×œ×”×–×× ×”.\n`;
            } else {
                selectedProducts.forEach(product => {
                    const { unitWeight, weightNotes } = calculateProductWeight(product.itemName);
                    const totalProductWeight = unitWeight * product.quantity;
                    message += `- ${product.itemName} (×‘×¨×§×•×“: ${product.barcode}), ×›××•×ª: ${product.quantity}, ××©×§×œ ×™×—×™×“×”: ${unitWeight} ×§"×’, ×¡×”"×› ××©×§×œ: ${totalProductWeight.toFixed(2)} ×§"×’ (${weightNotes})\n`;
                });
            }
            message += `\n*×¡×”"×› ×›××•×ª ×¤×¨×™×˜×™×:* ${totalQuantity}`;
            message += `\n*×¡×”"×› ××©×§×œ ×”×–×× ×”:* ${totalWeightDisplay.textContent} ×§"×’`;

            // Encode the message for URL
            const encodedMessage = encodeURIComponent(message);
            const whatsappUrl = `https://wa.me/${phoneNumberWhatsapp}?text=${encodedMessage}`;

            // Open WhatsApp in a new tab
            window.open(whatsappUrl, '_blank');
        });


        // --- Initial Load ---
        document.addEventListener('DOMContentLoaded', () => {
            // Check if the Apps Script URL is set
            if (googleAppsScriptUrl === 'YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL_HERE') {
                displayMessage('×× × ×”×—×œ×£ ××ª YOUR_GOOGLE_APPS_SCRIPT_WEB_APP_URL_HERE ×‘×›×ª×•×‘×ª ×”-URL ×©×œ ×”-Web App ×©×œ×š ×‘-Code.gs.', true);
            } else {
                fetchProducts(); // Fetch products when the page loads
            }
            renderOrderItems(); // Render initial empty table
            calculateTotalWeight(); // Calculate initial total weight (should be 0)

            // Set today's date as default for delivery date
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, '0'); // Months are 0-indexed
            const day = String(today.getDate()).padStart(2, '0');
            deliveryDateInput.value = `${year}-${month}-${day}`;
        });
    </script>
</body>
</html>
